import{_ as ee,c as F,j as te,r as w,H as n,o as se,w as ae,A as oe,B as le,a as g,b as s,d as o,g as c,h as f,t as i,m as d,q as ne,E as H,Y as k,I as ce,D as ie,G as re,J as de,K as ue,L as _e,M as pe,N as ge,O as j,P as fe,Q as me,R as ve,S as G,T as he,U as ye,V as we,W as Ce,X as ke,k as De,l as r,C as m,Z as K,u,x as O,s as D,F as I,p as N,v as be,$ as Ae,a0 as xe}from"./index-Cyn0SW9k.js";import{a as ze,g as Fe}from"./category-0V6O-N7O.js";import{g as P}from"./article-DKK3_dIc.js";const Ie={class:"category-detail-container"},Ne={class:"category-header"},Ve={class:"header-content"},$e={class:"category-icon-large"},Be={class:"title"},Me={class:"description"},Le={class:"category-meta"},Re={class:"meta-item"},Te={class:"meta-item"},Se={class:"articles-header"},Ee={class:"section-title"},He={class:"count"},je={class:"articles-list"},Ge=["onClick"],Ke={key:0,class:"article-cover"},Oe=["src","alt"],Pe={class:"article-content"},Ue={class:"article-top"},We={class:"article-title"},Ye={class:"article-badges"},qe={class:"article-summary"},Je={class:"article-meta"},Qe={class:"meta-item"},Xe={class:"meta-item"},Ze={class:"meta-item"},et={class:"meta-item tags"},tt={class:"section-title"},st={class:"related-list"},at=["onClick"],ot={class:"related-icon"},lt={class:"related-info"},nt={class:"related-title"},ct={class:"related-desc"},it={class:"related-meta"},rt={__name:"CategoryDetail",setup(dt){const V=te(),$=De(),B=F(()=>V.params.slug),v=w("date"),h=w(!0),b={Folder:n(k),Platform:n(ke),Monitor:n(Ce),Cpu:n(we),Coin:n(ye),Setting:n(he),Document:n(G),DataAnalysis:n(ve),Collection:n(me),Grid:n(fe),List:n(j),Menu:n(ge),Operation:n(pe),Tools:n(_e),Connection:n(ue),Link:n(de),Share:n(re),Star:n(ie),Trophy:n(ce)},M=t=>t&&b[t]||b.Folder,_=w({id:0,slug:B.value,name:"",description:"",icon:n(k),bgImage:"https://picsum.photos/id/1084/1920/600",count:0}),y=w([]),A=w([]),U=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return t;const a=e.getFullYear(),p=String(e.getMonth()+1).padStart(2,"0"),x=String(e.getDate()).padStart(2,"0");return`${a}-${p}-${x}`}catch{return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}/.test(t)?t.split(" ")[0]||t.split("T")[0]:t}},L=async()=>{try{const t=await ze({slug:B.value});if(t){const e=t;_.value={id:e.id,slug:e.slug,name:e.name,description:e.description||e.name+"相关技术文章",icon:M(e.icon||"Folder"),bgImage:"https://picsum.photos/id/"+e.id%100+"/1920/600",count:0},await W()}else H.error("分类不存在")}catch(t){console.error("加载分类失败:",t),H.error("加载分类失败")}},W=async()=>{try{const t=await P({categoryId:_.value.id,page:1,size:100,status:"published"});y.value=(t.list||[]).map(e=>({id:e.id,title:e.title,summary:e.desc||"",cover:e.coverImage||"https://picsum.photos/id/"+e.id+"/400/300",createdAt:U(e.createdAt),views:e.views||0,comments:0,tags:e.tags?typeof e.tags=="string"?e.tags.split(","):e.tags:[],isNew:!1,isHot:!1})),_.value.count=y.value.length}catch(t){console.error("加载文章失败:",t)}},R=async()=>{try{const e=((await Fe({page:1,size:10})).list||[]).filter(a=>a.id!==_.value.id).slice(0,3).map(a=>({id:a.id,slug:a.slug,name:a.name,description:a.description||a.name+"相关技术文章",icon:M(a.icon||"Folder"),count:0}));for(let a of e)try{const p=await P({categoryId:a.id,page:1,size:1});a.count=p.total||0}catch{a.count=0}A.value=e}catch(t){console.error("加载相关分类失败:",t)}};se(async()=>{h.value=!0,await L(),await R(),h.value=!1}),ae(()=>V.params.slug,async t=>{t&&(h.value=!0,await L(),await R(),h.value=!1)});const Y=F(()=>y.value.reduce((t,e)=>t+e.views,0)),T=F(()=>{const t=[...y.value];return v.value==="date"?t.sort((e,a)=>new Date(a.createdAt)-new Date(e.createdAt)):v.value==="views"?t.sort((e,a)=>a.views-e.views):v.value==="comments"&&t.sort((e,a)=>a.comments-e.comments),t}),S=t=>t>=1e4?(t/1e4).toFixed(1)+"W":t>=1e3?(t/1e3).toFixed(1)+"K":t,q=t=>{$.push(`/article/${t.id}`)},J=t=>{$.push(`/category/${t.slug}`)};return(t,e)=>{const a=f("el-icon"),p=f("el-option"),x=f("el-select"),z=f("el-tag"),E=f("el-card"),Q=f("el-col"),X=f("el-row"),Z=le("loading");return oe((r(),g("div",Ie,[s("div",Ne,[s("div",Ve,[s("div",$e,[o(a,{size:60},{default:c(()=>[(r(),m(K(_.value.icon||u(k))))]),_:1})]),s("h1",Be,i(_.value.name),1),s("p",Me,i(_.value.description),1),s("div",Le,[s("span",Re,[o(a,null,{default:c(()=>[o(u(G))]),_:1}),d(" "+i(y.value.length)+" 篇文章 ",1)]),e[1]||(e[1]=s("span",{class:"divider"},"·",-1)),s("span",Te,[o(a,null,{default:c(()=>[o(u(O))]),_:1}),d(" "+i(S(Y.value))+" 阅读 ",1)])])]),s("div",{class:"header-image",style:ne({backgroundImage:`url(${_.value.bgImage})`})},null,4)]),o(X,{justify:"center",class:"content-wrapper"},{default:c(()=>[o(Q,{span:18,xs:22,sm:20,md:18,lg:16},{default:c(()=>[o(E,{class:"articles-card",shadow:"never"},{default:c(()=>[s("div",Se,[s("h3",Ee,[o(a,null,{default:c(()=>[o(u(j))]),_:1}),e[2]||(e[2]=d(" 全部文章 ",-1)),s("span",He,"("+i(T.value.length)+")",1)]),o(x,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),style:{width:"140px"},size:"small"},{default:c(()=>[o(p,{label:"最新发布",value:"date"}),o(p,{label:"最多阅读",value:"views"}),o(p,{label:"最多评论",value:"comments"})]),_:1},8,["modelValue"])]),s("div",je,[(r(!0),g(I,null,N(T.value,l=>(r(),g("div",{key:l.id,class:"article-item",onClick:C=>q(l)},[l.cover?(r(),g("div",Ke,[s("img",{src:l.cover,alt:l.title},null,8,Oe)])):D("",!0),s("div",Pe,[s("div",Ue,[s("h4",We,i(l.title),1),s("div",Ye,[l.isNew?(r(),m(z,{key:0,type:"success",size:"small",effect:"plain"},{default:c(()=>[...e[3]||(e[3]=[d("新",-1)])]),_:1})):D("",!0),l.isHot?(r(),m(z,{key:1,type:"danger",size:"small",effect:"plain"},{default:c(()=>[...e[4]||(e[4]=[d("热",-1)])]),_:1})):D("",!0)])]),s("p",qe,i(l.summary),1),s("div",Je,[s("span",Qe,[o(a,null,{default:c(()=>[o(u(be))]),_:1}),d(" "+i(l.createdAt),1)]),s("span",Xe,[o(a,null,{default:c(()=>[o(u(O))]),_:1}),d(" "+i(S(l.views)),1)]),s("span",Ze,[o(a,null,{default:c(()=>[o(u(Ae))]),_:1}),d(" "+i(l.comments),1)]),s("span",et,[(r(!0),g(I,null,N(l.tags.slice(0,3),C=>(r(),m(z,{key:C,size:"small",effect:"plain"},{default:c(()=>[d(i(C),1)]),_:2},1024))),128))])])])],8,Ge))),128))])]),_:1}),A.value.length>0?(r(),m(E,{key:0,class:"related-card",shadow:"never"},{default:c(()=>[s("h3",tt,[o(a,null,{default:c(()=>[o(u(xe))]),_:1}),e[5]||(e[5]=d(" 相关分类 ",-1))]),s("div",st,[(r(!0),g(I,null,N(A.value,l=>(r(),g("div",{key:l.id,class:"related-item",onClick:C=>J(l)},[s("div",ot,[o(a,{size:32},{default:c(()=>[(r(),m(K(l.icon||u(k))))]),_:2},1024)]),s("div",lt,[s("h4",nt,i(l.name),1),s("p",ct,i(l.description),1),s("div",it,i(l.count)+" 篇文章 ",1)])],8,at))),128))])]),_:1})):D("",!0)]),_:1})]),_:1})])),[[Z,h.value]])}}},gt=ee(rt,[["__scopeId","data-v-f6caca0c"]]);export{gt as default};
