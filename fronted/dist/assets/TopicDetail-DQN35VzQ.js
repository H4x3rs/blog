import{_ as Y,c as D,j as G,r as h,o as J,w as P,A as Q,B as S,a as p,b as t,d as a,F as I,p as N,a5 as X,t as i,m as r,g as n,h as v,q as Z,E as ee,k as te,l as d,C as f,u as _,S as se,x as M,a9 as ae,s as g,aa as oe,O as le,v as ie,$ as ne,a0 as ce}from"./index-DuLhCfRm.js";import{d as re}from"./marked.esm-DajSjiQI.js";import{b as de,g as ue,a as _e}from"./topic-B2AS15Vl.js";const ve={class:"topic-detail-container"},pe={class:"topic-header"},me={class:"header-content"},he={class:"meta-info"},fe={class:"title"},ge={class:"description"},we={class:"topic-meta"},ye={class:"meta-item"},ke={class:"meta-item"},Ce={class:"meta-item"},Te={class:"author-info"},Ae={class:"author-name"},be={class:"section-title"},xe=["innerHTML"],De={class:"articles-header"},Ie={class:"section-title"},Ne={class:"count"},$e={class:"articles-list"},ze=["onClick"],Fe={class:"article-number"},Ve={class:"article-content"},Be={class:"article-top"},Me={class:"article-title"},qe={class:"article-badges"},He={class:"article-summary"},Le={class:"article-meta"},Ee={class:"meta-item"},Re={class:"meta-item"},je={class:"meta-item"},Ke={key:0,class:"article-cover"},Oe=["src","alt"],Ue={class:"section-title"},We={class:"related-list"},Ye=["onClick"],Ge={class:"related-cover"},Je=["src"],Pe={class:"related-info"},Qe={class:"related-title"},Se={class:"related-desc"},Xe={class:"related-meta"},Ze={__name:"TopicDetail",setup(et){const $=G(),z=te(),k=D(()=>$.params.id),w=h("default"),m=h(!0),c=h({id:k.value,name:"",description:"",cover:"",tags:[],articleCount:0,views:0,status:"连载中",updateFrequency:"每周更新",author:{name:"Admin",avatar:"https://i.pravatar.cc/150?img=1"},intro:""}),y=h([]),C=h([]),q=e=>{if(!e)return"";try{const s=new Date(e);if(isNaN(s.getTime()))return e;const u=s.getFullYear(),l=String(s.getMonth()+1).padStart(2,"0"),A=String(s.getDate()).padStart(2,"0");return`${u}-${l}-${A}`}catch{return typeof e=="string"&&/^\d{4}-\d{2}-\d{2}/.test(e)?e.split(" ")[0]||e.split("T")[0]:e}},F=async()=>{try{const e=await de({id:parseInt(k.value)});e&&(c.value={id:e.id,name:e.name||"",description:e.description||"",cover:e.coverImage||"https://picsum.photos/id/"+e.id+"/1200/600",tags:[],articleCount:0,views:0,status:"连载中",updateFrequency:"每周更新",author:{name:"Admin",avatar:"https://i.pravatar.cc/150?img=1"},intro:e.intro||""},await H())}catch(e){console.error("加载专题失败:",e),ee.error("加载专题失败")}},H=async()=>{try{const e=await _e({id:parseInt(k.value),page:1,size:100});e&&e.list&&(y.value=e.list.map((s,u)=>{const l=s.article||s;return{id:l.id,title:l.title||"",summary:l.desc||"",cover:l.coverImage||"https://picsum.photos/id/"+l.id+"/400/300",createdAt:q(l.createdAt),views:l.views||0,comments:0,isNew:u<3,isHot:!1}}),c.value.articleCount=e.total||y.value.length)}catch(e){console.error("加载专题文章失败:",e)}},V=async()=>{try{const e=await ue({page:1,size:10});C.value=(e.list||[]).filter(s=>s.id!==c.value.id).slice(0,2).map(s=>({id:s.id,name:s.name,description:s.description||"",cover:s.coverImage||"https://picsum.photos/id/"+s.id+"/300/200",articleCount:0,views:0}))}catch(e){console.error("加载相关专题失败:",e)}};J(async()=>{m.value=!0,await F(),await V(),m.value=!1}),P(()=>$.params.id,async e=>{e&&(m.value=!0,await F(),await V(),m.value=!1)});const L=D(()=>c.value.intro?re.parse(c.value.intro):""),E=D(()=>{const e=[...y.value];return w.value==="date"?e.sort((s,u)=>new Date(u.createdAt)-new Date(s.createdAt)):w.value==="views"&&e.sort((s,u)=>u.views-s.views),e}),T=e=>e>=1e4?(e/1e4).toFixed(1)+"W":e>=1e3?(e/1e3).toFixed(1)+"K":e,R=e=>{z.push(`/article/${e.id}`)},j=e=>{z.push(`/topic/${e.id}`)};return(e,s)=>{const u=v("el-tag"),l=v("el-icon"),A=v("el-avatar"),b=v("el-card"),x=v("el-option"),K=v("el-select"),O=v("el-col"),U=v("el-row"),W=S("loading");return Q((d(),p("div",ve,[t("div",pe,[t("div",me,[t("div",he,[(d(!0),p(I,null,N(c.value.tags,o=>(d(),f(u,{key:o,effect:"dark",round:"",class:"topic-tag"},{default:n(()=>[r(i(o),1)]),_:2},1024))),128)),t("span",{class:X(["status-tag",c.value.status==="连载中"?"status-updating":"status-finished"])},i(c.value.status),3)]),t("h1",fe,i(c.value.name),1),t("p",ge,i(c.value.description),1),t("div",we,[t("span",ye,[a(l,null,{default:n(()=>[a(_(se))]),_:1}),r(" "+i(c.value.articleCount)+" 篇文章 ",1)]),s[1]||(s[1]=t("span",{class:"divider"},"·",-1)),t("span",ke,[a(l,null,{default:n(()=>[a(_(M))]),_:1}),r(" "+i(T(c.value.views))+" 阅读 ",1)]),s[2]||(s[2]=t("span",{class:"divider"},"·",-1)),t("span",Ce,[a(l,null,{default:n(()=>[a(_(ae))]),_:1}),r(" "+i(c.value.updateFrequency),1)])]),t("div",Te,[a(A,{size:32,src:c.value.author.avatar},null,8,["src"]),t("span",Ae,i(c.value.author.name),1),s[3]||(s[3]=t("span",{class:"author-role"},"专题作者",-1))])]),t("div",{class:"header-image",style:Z({backgroundImage:`url(${c.value.cover})`})},null,4)]),a(U,{justify:"center",class:"content-wrapper"},{default:n(()=>[a(O,{span:18,xs:22,sm:20,md:18,lg:16},{default:n(()=>[c.value.intro?(d(),f(b,{key:0,class:"intro-card",shadow:"never"},{default:n(()=>[t("h3",be,[a(l,null,{default:n(()=>[a(_(oe))]),_:1}),s[4]||(s[4]=r(" 专题介绍 ",-1))]),t("div",{class:"markdown-body",innerHTML:L.value},null,8,xe)]),_:1})):g("",!0),a(b,{class:"articles-card",shadow:"never"},{default:n(()=>[t("div",De,[t("h3",Ie,[a(l,null,{default:n(()=>[a(_(le))]),_:1}),s[5]||(s[5]=r(" 文章列表 ",-1)),t("span",Ne,"("+i(y.value.length)+")",1)]),a(K,{modelValue:w.value,"onUpdate:modelValue":s[0]||(s[0]=o=>w.value=o),style:{width:"140px"},size:"small"},{default:n(()=>[a(x,{label:"默认排序",value:"default"}),a(x,{label:"最新发布",value:"date"}),a(x,{label:"最多阅读",value:"views"})]),_:1},8,["modelValue"])]),t("div",$e,[(d(!0),p(I,null,N(E.value,(o,B)=>(d(),p("div",{key:o.id,class:"article-item",onClick:tt=>R(o)},[t("div",Fe,i(B+1),1),t("div",Ve,[t("div",Be,[t("h4",Me,i(o.title),1),t("div",qe,[o.isNew?(d(),f(u,{key:0,type:"success",size:"small",effect:"plain"},{default:n(()=>[...s[6]||(s[6]=[r("新",-1)])]),_:1})):g("",!0),o.isHot?(d(),f(u,{key:1,type:"danger",size:"small",effect:"plain"},{default:n(()=>[...s[7]||(s[7]=[r("热",-1)])]),_:1})):g("",!0)])]),t("p",He,i(o.summary),1),t("div",Le,[t("span",Ee,[a(l,null,{default:n(()=>[a(_(ie))]),_:1}),r(" "+i(o.createdAt),1)]),t("span",Re,[a(l,null,{default:n(()=>[a(_(M))]),_:1}),r(" "+i(T(o.views)),1)]),t("span",je,[a(l,null,{default:n(()=>[a(_(ne))]),_:1}),r(" "+i(o.comments),1)])])]),o.cover?(d(),p("div",Ke,[t("img",{src:o.cover,alt:o.title},null,8,Oe)])):g("",!0)],8,ze))),128))])]),_:1}),C.value.length>0?(d(),f(b,{key:1,class:"related-card",shadow:"never"},{default:n(()=>[t("h3",Ue,[a(l,null,{default:n(()=>[a(_(ce))]),_:1}),s[8]||(s[8]=r(" 相关专题 ",-1))]),t("div",We,[(d(!0),p(I,null,N(C.value,o=>(d(),p("div",{key:o.id,class:"related-item",onClick:B=>j(o)},[t("div",Ge,[t("img",{src:o.cover,alt:""},null,8,Je)]),t("div",Pe,[t("h4",Qe,i(o.name),1),t("p",Se,i(o.description),1),t("div",Xe,i(o.articleCount)+" 篇 · "+i(T(o.views))+" 阅读 ",1)])],8,Ye))),128))])]),_:1})):g("",!0)]),_:1})]),_:1})])),[[W,m.value]])}}},lt=Y(Ze,[["__scopeId","data-v-1888c22b"]]);export{lt as default};
