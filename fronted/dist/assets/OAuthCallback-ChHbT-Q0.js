import{_ as m,r as p,o as g,j as h,E as r,k as v,an as k,a as f,b as c,d,g as w,h as b,t as y,l as x,u as C,ao as I}from"./index-DJyl22Gq.js";const S={class:"oauth-callback-container"},T={class:"loading-wrapper"},q={class:"loading-spinner"},A={class:"loading-text"},E={__name:"OAuthCallback",setup(O){const o=v(),t=h(),a=p("正在处理登录...");g(()=>{_()});const _=async()=>{const n=t.query.code,l=t.query.state,s=t.query.error,i=t.query.error_description;if(s||i){a.value="登录失败",r.error(i||s||"OAuth登录失败"),setTimeout(()=>{o.replace("/login-new")},2e3);return}if(!n){a.value="缺少授权码",r.warning("请先进行登录"),setTimeout(()=>{o.replace("/login-new")},2e3);return}const u=t.params.provider;a.value="正在验证登录信息...";try{const e=await k(u,n,l);if(e&&e.token)a.value="登录成功，正在跳转...",localStorage.setItem("token",e.token),localStorage.setItem("username",e.username),e.nickname&&localStorage.setItem("nickname",e.nickname),e.avatar&&localStorage.setItem("avatar",e.avatar),localStorage.setItem("loginProvider",u),r.success("登录成功！"),setTimeout(()=>{o.replace("/admin/dashboard")},500);else throw new Error("登录失败：未获取到token")}catch(e){a.value="登录失败",r.error(e.message||"登录失败，请重试"),setTimeout(()=>{o.replace("/login-new")},2e3)}};return(n,l)=>{const s=b("el-icon");return x(),f("div",S,[c("div",T,[c("div",q,[d(s,{class:"is-loading",size:48},{default:w(()=>[d(C(I))]),_:1})]),c("p",A,y(a.value),1)])])}}},D=m(E,[["__scopeId","data-v-693e7fc3"]]);export{D as default};
