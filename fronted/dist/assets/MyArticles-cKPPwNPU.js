import{_ as G,r as c,c as A,o as H,E as M,k as J,A as Q,B as X,a as _,b as s,d as l,t as r,g as n,h as i,l as d,ad as Z,m as p,C as ee,s as D,u as x,O as te,F as se,p as le,v as ae,x as oe,Y as ne}from"./index-DEcr5ABh.js";import{g as ie}from"./article-DA5xFmXb.js";const re={class:"my-articles-container"},ue={class:"articles-header-section"},de={class:"header-content"},ce={class:"header-stats"},_e={class:"stat-item"},pe={class:"stat-value"},ve={class:"stat-item"},me={class:"stat-value"},fe={class:"stat-item"},ge={class:"stat-value"},he={class:"articles-header"},ye={class:"section-title"},we={class:"count"},be={key:1,class:"articles-list"},ke=["onClick"],xe={key:0,class:"article-cover"},Ce=["src","alt"],Ve={class:"article-content"},Ae={class:"article-top"},De={class:"article-title"},Ne={class:"article-badges"},ze={class:"article-summary"},Be={class:"article-meta"},Fe={class:"meta-item"},Me={class:"meta-item"},$e={key:0,class:"meta-item"},Ee={key:2,class:"pagination-wrapper"},Ie={__name:"MyArticles",setup(Ke){const C=J(),h=c(!0),v=c([]),y=c(0),f=c(1),V=c(12),w=c("date"),u=c({title:"",status:""}),$=t=>{if(!t)return"";try{const e=new Date(t);if(isNaN(e.getTime()))return t;const o=e.getFullYear(),g=String(e.getMonth()+1).padStart(2,"0"),m=String(e.getDate()).padStart(2,"0");return`${o}-${g}-${m}`}catch{return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}/.test(t)?t.split(" ")[0]||t.split("T")[0]:t}},E=t=>t>=1e4?(t/1e4).toFixed(1)+"W":t>=1e3?(t/1e3).toFixed(1)+"K":t,I=A(()=>v.value.filter(t=>t.status==="published").length),K=A(()=>v.value.filter(t=>t.status==="draft").length),b=async()=>{h.value=!0;try{const t={page:f.value,size:V.value,title:u.value.title||"",status:u.value.status||"",onlyMine:!0},e=await ie(t);v.value=(e.list||[]).map(o=>({id:o.id,title:o.title,summary:o.desc||"",cover:o.coverImage||"https://picsum.photos/id/"+o.id+"/400/300",createdAt:$(o.createdAt),views:o.views||0,status:o.status||"draft",category:o.categoryName||""})),y.value=e.total||0}catch(t){console.error("加载文章失败:",t),M.error("加载文章失败")}finally{h.value=!1}},T=A(()=>{const t=[...v.value];return w.value==="date"?t.sort((e,o)=>new Date(o.createdAt)-new Date(e.createdAt)):w.value==="views"&&t.sort((e,o)=>o.views-e.views),t}),N=()=>{f.value=1,b()},U=()=>{u.value.title="",u.value.status="",f.value=1,b()},L=t=>{f.value=t,b()},P=t=>{t.status==="published"?C.push(`/article/${t.id}`):C.push(`/admin/articles/edit/${t.id}`)};return H(()=>{if(!localStorage.getItem("token")){M.warning("请先登录"),C.push("/login-new");return}b()}),(t,e)=>{const o=i("el-input"),g=i("el-form-item"),m=i("el-option"),z=i("el-select"),B=i("el-button"),Y=i("el-form"),F=i("el-card"),k=i("el-icon"),j=i("el-empty"),O=i("el-tag"),R=i("el-pagination"),S=i("el-col"),W=i("el-row"),q=X("loading");return Q((d(),_("div",re,[s("div",ue,[s("div",de,[e[8]||(e[8]=s("h1",{class:"page-title"},"我的文章",-1)),e[9]||(e[9]=s("p",{class:"page-subtitle"},"管理您发布的所有文章",-1)),s("div",ce,[s("div",_e,[s("span",pe,r(y.value),1),e[3]||(e[3]=s("span",{class:"stat-label"},"总文章数",-1))]),e[6]||(e[6]=s("div",{class:"stat-divider"},null,-1)),s("div",ve,[s("span",me,r(I.value),1),e[4]||(e[4]=s("span",{class:"stat-label"},"已发布",-1))]),e[7]||(e[7]=s("div",{class:"stat-divider"},null,-1)),s("div",fe,[s("span",ge,r(K.value),1),e[5]||(e[5]=s("span",{class:"stat-label"},"草稿",-1))])])])]),l(W,{justify:"center",class:"content-wrapper"},{default:n(()=>[l(S,{span:18,xs:22,sm:20,md:18,lg:16},{default:n(()=>[l(F,{class:"filter-card",shadow:"never"},{default:n(()=>[l(Y,{inline:!0,model:u.value,class:"filter-form"},{default:n(()=>[l(g,{label:"标题"},{default:n(()=>[l(o,{modelValue:u.value.title,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value.title=a),placeholder:"搜索文章标题",clearable:"",style:{width:"200px"},onKeyup:Z(N,["enter"])},null,8,["modelValue"])]),_:1}),l(g,{label:"状态"},{default:n(()=>[l(z,{modelValue:u.value.status,"onUpdate:modelValue":e[1]||(e[1]=a=>u.value.status=a),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:n(()=>[l(m,{label:"已发布",value:"published"}),l(m,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),_:1}),l(g,null,{default:n(()=>[l(B,{type:"primary",onClick:N},{default:n(()=>[...e[10]||(e[10]=[p("查询",-1)])]),_:1}),l(B,{onClick:U},{default:n(()=>[...e[11]||(e[11]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(F,{class:"articles-card",shadow:"never"},{default:n(()=>[s("div",he,[s("h3",ye,[l(k,null,{default:n(()=>[l(x(te))]),_:1}),e[12]||(e[12]=p(" 文章列表 ",-1)),s("span",we,"("+r(v.value.length)+")",1)]),l(z,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),style:{width:"140px"},size:"small"},{default:n(()=>[l(m,{label:"最新发布",value:"date"}),l(m,{label:"最多阅读",value:"views"})]),_:1},8,["modelValue"])]),v.value.length===0&&!h.value?(d(),ee(j,{key:0,description:"暂无文章"})):(d(),_("div",be,[(d(!0),_(se,null,le(T.value,a=>(d(),_("div",{key:a.id,class:"article-item",onClick:Te=>P(a)},[a.cover?(d(),_("div",xe,[s("img",{src:a.cover,alt:a.title},null,8,Ce)])):D("",!0),s("div",Ve,[s("div",Ae,[s("h4",De,r(a.title),1),s("div",Ne,[l(O,{type:a.status==="published"?"success":"info",size:"small",effect:"plain"},{default:n(()=>[p(r(a.status==="published"?"已发布":"草稿"),1)]),_:2},1032,["type"])])]),s("p",ze,r(a.summary),1),s("div",Be,[s("span",Fe,[l(k,null,{default:n(()=>[l(x(ae))]),_:1}),p(" "+r(a.createdAt),1)]),s("span",Me,[l(k,null,{default:n(()=>[l(x(oe))]),_:1}),p(" "+r(E(a.views)),1)]),a.category?(d(),_("span",$e,[l(k,null,{default:n(()=>[l(x(ne))]),_:1}),p(" "+r(a.category),1)])):D("",!0)])])],8,ke))),128))])),y.value>V.value?(d(),_("div",Ee,[l(R,{background:"",layout:"prev, pager, next",total:y.value,"current-page":f.value,"page-size":V.value,onCurrentChange:L},null,8,["total","current-page","page-size"])])):D("",!0)]),_:1})]),_:1})]),_:1})])),[[q,h.value]])}}},Pe=G(Ie,[["__scopeId","data-v-802da577"]]);export{Pe as default};
