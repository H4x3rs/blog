import{_ as Q,af as F,r as m,w as W,o as X,a as v,d as e,A as Z,g as a,h as i,B as ee,C as te,s as N,F as le,p as ae,E as y,k as oe,l as _,u as g,a2 as se,m as p,ap as ne,a8 as re,b as c,aq as de,t as b,y as E,ar as ie,as as ce,x as ue,a7 as pe,at as fe}from"./index-85xZPJNu.js";import{g as _e,d as ge,c as me,u as ve}from"./article-DaC9qJPf.js";const ye={class:"article-manage"},be={class:"article-list"},he={key:1,class:"article-grid"},Ve={class:"article-cover"},we={class:"image-slot"},ke={class:"article-status"},Ie={class:"article-actions-overlay"},xe={class:"article-content"},Ce={class:"article-meta-top"},Ue={class:"date"},Be=["title"],ze={class:"article-desc"},De={class:"article-footer"},Ae={class:"stats"},Me={key:0,class:"publisher"},Te={key:2,class:"pagination-container"},$e={class:"dialog-footer"},Fe={__name:"ArticleManage",setup(Ne){const z=oe(),r=F({title:"",category:"",status:""}),h=m(1),w=m(12),x=m(0),C=m(!1),U=m([]),k=m(!1),D=m("create"),o=F({id:null,title:"",categoryId:null,desc:"",content:"",coverImage:"",status:"draft"}),V=async()=>{C.value=!0;try{const n={page:h.value,size:w.value,title:r.title,categoryId:r.category?parseInt(r.category):0,status:r.status},t=await _e(n);U.value=(t.list||[]).map(s=>({id:s.id,title:s.title,desc:s.desc,cover:s.coverImage,status:s.status,views:s.views||0,date:j(s.createdAt),category:s.categoryId||"",content:s.content,publishedBy:s.publishedByUser?s.publishedByUser.nickname||s.publishedByUser.username:""})),x.value=t.total||0}catch(n){y.error("获取文章列表失败"),console.error(n)}finally{C.value=!1}},L=()=>{h.value=1,V()},R=()=>{r.title="",r.category="",r.status="",h.value=1,V()},A=()=>{z.push("/admin/articles/edit")},G=(n,t)=>{t?z.push(`/admin/articles/edit/${t.id}`):A()},P=n=>{fe.confirm("确定要删除这篇文章吗？删除后无法恢复。","警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await ge({id:n.id}),y.success("删除成功"),V()}catch(t){y.error("删除失败"),console.error(t)}}).catch(()=>{})},S=async()=>{if(!o.title||!o.content){y.warning("请填写标题和内容");return}try{D.value==="create"?(await me({title:o.title,content:o.content,desc:o.desc,coverImage:o.coverImage,categoryId:o.categoryId||0,status:o.status}),y.success("发布成功")):(await ve({id:o.id,title:o.title,content:o.content,desc:o.desc,coverImage:o.coverImage,categoryId:o.categoryId||0,status:o.status}),y.success("更新成功")),k.value=!1,V()}catch(n){y.error("操作失败"),console.error(n)}},j=n=>{if(!n)return"";try{const t=new Date(n);if(isNaN(t.getTime()))return n;const s=t.getFullYear(),d=String(t.getMonth()+1).padStart(2,"0"),u=String(t.getDate()).padStart(2,"0");return`${s}-${d}-${u}`}catch{return typeof n=="string"&&/^\d{4}-\d{2}-\d{2}/.test(n)?n.split(" ")[0]||n.split("T")[0]:n}};return W([h,w],()=>{V()}),X(()=>{V()}),(n,t)=>{const s=i("el-input"),d=i("el-form-item"),u=i("el-option"),I=i("el-select"),f=i("el-button"),M=i("el-form"),T=i("el-card"),q=i("el-empty"),B=i("el-icon"),Y=i("el-image"),$=i("el-tag"),H=i("el-pagination"),J=i("el-dialog"),K=ee("loading");return _(),v("div",ye,[e(T,{shadow:"never",class:"filter-card"},{default:a(()=>[e(M,{inline:!0,model:r,class:"filter-form"},{default:a(()=>[e(d,{label:"文章标题"},{default:a(()=>[e(s,{modelValue:r.title,"onUpdate:modelValue":t[0]||(t[0]=l=>r.title=l),placeholder:"请输入标题关键字",clearable:""},null,8,["modelValue"])]),_:1}),e(d,{label:"分类"},{default:a(()=>[e(I,{modelValue:r.category,"onUpdate:modelValue":t[1]||(t[1]=l=>r.category=l),placeholder:"请选择分类",clearable:"",style:{width:"180px"}},{default:a(()=>[e(u,{label:"Golang",value:"golang"}),e(u,{label:"Frontend",value:"frontend"}),e(u,{label:"Database",value:"database"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"状态"},{default:a(()=>[e(I,{modelValue:r.status,"onUpdate:modelValue":t[2]||(t[2]=l=>r.status=l),placeholder:"状态",clearable:"",style:{width:"120px"}},{default:a(()=>[e(u,{label:"已发布",value:"published"}),e(u,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:a(()=>[e(f,{type:"primary",icon:g(se),onClick:L},{default:a(()=>[...t[13]||(t[13]=[p("查询",-1)])]),_:1},8,["icon"]),e(f,{icon:g(ne),onClick:R},{default:a(()=>[...t[14]||(t[14]=[p("重置",-1)])]),_:1},8,["icon"])]),_:1}),e(d,{style:{"margin-left":"auto"}},{default:a(()=>[e(f,{type:"primary",icon:g(re),onClick:A},{default:a(()=>[...t[15]||(t[15]=[p("发布文章",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),Z((_(),v("div",be,[U.value.length===0?(_(),te(q,{key:0,description:"暂无文章数据"})):(_(),v("div",he,[(_(!0),v(le,null,ae(U.value,l=>(_(),v("div",{key:l.id,class:"article-card-wrapper"},[e(T,{shadow:"hover",class:"article-card","body-style":{padding:"0px"}},{default:a(()=>[c("div",Ve,[e(Y,{src:l.cover,fit:"cover",lazy:""},{error:a(()=>[c("div",we,[e(B,null,{default:a(()=>[e(g(de))]),_:1})])]),_:1},8,["src"]),c("div",ke,[e($,{type:l.status==="published"?"success":"info",effect:"dark",size:"small"},{default:a(()=>[p(b(l.status==="published"?"已发布":"草稿"),1)]),_:2},1032,["type"])]),c("div",Ie,[e(f,{circle:"",type:"primary",icon:g(ie),onClick:E(O=>G("edit",l),["stop"])},null,8,["icon","onClick"]),e(f,{circle:"",type:"danger",icon:g(ce),onClick:E(O=>P(l),["stop"])},null,8,["icon","onClick"])])]),c("div",xe,[c("div",Ce,[e($,{size:"small",effect:"plain",class:"cat-tag"},{default:a(()=>[p(b(l.category),1)]),_:2},1024),c("span",Ue,b(l.date),1)]),c("h3",{class:"article-title",title:l.title},b(l.title),9,Be),c("p",ze,b(l.desc),1),c("div",De,[c("div",Ae,[c("span",null,[e(B,null,{default:a(()=>[e(g(ue))]),_:1}),p(" "+b(l.views),1)]),l.publishedBy?(_(),v("span",Me,[e(B,null,{default:a(()=>[e(g(pe))]),_:1}),p(" "+b(l.publishedBy),1)])):N("",!0)]),e(f,{link:"",type:"primary",size:"small"},{default:a(()=>[...t[16]||(t[16]=[p("查看详情",-1)])]),_:1})])])]),_:2},1024)]))),128))])),x.value>w.value?(_(),v("div",Te,[e(H,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:x.value,"page-sizes":[12,24,36,48],"current-page":h.value,"onUpdate:currentPage":t[3]||(t[3]=l=>h.value=l),"page-size":w.value,"onUpdate:pageSize":t[4]||(t[4]=l=>w.value=l)},null,8,["total","current-page","page-size"])])):N("",!0)])),[[K,C.value]]),e(J,{modelValue:k.value,"onUpdate:modelValue":t[12]||(t[12]=l=>k.value=l),title:D.value==="create"?"发布文章":"编辑文章",width:"60%","destroy-on-close":"","align-center":""},{footer:a(()=>[c("span",$e,[e(f,{onClick:t[11]||(t[11]=l=>k.value=!1)},{default:a(()=>[...t[17]||(t[17]=[p("取消",-1)])]),_:1}),e(f,{type:"primary",onClick:S},{default:a(()=>[...t[18]||(t[18]=[p("确认",-1)])]),_:1})])]),default:a(()=>[e(M,{model:o,"label-width":"80px"},{default:a(()=>[e(d,{label:"标题"},{default:a(()=>[e(s,{modelValue:o.title,"onUpdate:modelValue":t[5]||(t[5]=l=>o.title=l),placeholder:"请输入文章标题"},null,8,["modelValue"])]),_:1}),e(d,{label:"分类"},{default:a(()=>[e(I,{modelValue:o.categoryId,"onUpdate:modelValue":t[6]||(t[6]=l=>o.categoryId=l),placeholder:"请选择分类",style:{width:"100%"}},{default:a(()=>[e(u,{label:"Golang",value:1}),e(u,{label:"Frontend",value:2}),e(u,{label:"Database",value:3})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"状态"},{default:a(()=>[e(I,{modelValue:o.status,"onUpdate:modelValue":t[7]||(t[7]=l=>o.status=l),placeholder:"请选择状态",style:{width:"100%"}},{default:a(()=>[e(u,{label:"草稿",value:"draft"}),e(u,{label:"已发布",value:"published"})]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"摘要"},{default:a(()=>[e(s,{modelValue:o.desc,"onUpdate:modelValue":t[8]||(t[8]=l=>o.desc=l),type:"textarea",rows:3,placeholder:"请输入文章摘要"},null,8,["modelValue"])]),_:1}),e(d,{label:"内容"},{default:a(()=>[e(s,{modelValue:o.content,"onUpdate:modelValue":t[9]||(t[9]=l=>o.content=l),type:"textarea",rows:10,placeholder:"Markdown / Rich Text Content",style:{"font-family":"monospace"}},null,8,["modelValue"])]),_:1}),e(d,{label:"封面图"},{default:a(()=>[e(s,{modelValue:o.coverImage,"onUpdate:modelValue":t[10]||(t[10]=l=>o.coverImage=l),placeholder:"图片 URL"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Re=Q(Fe,[["__scopeId","data-v-1057b6b8"]]);export{Re as default};
