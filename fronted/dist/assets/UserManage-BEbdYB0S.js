import{_ as re,r as i,af as J,w as ne,o as ie,a as O,d as a,g as l,h as n,aG as ue,E as u,B as de,l as z,u as d,a2 as P,m as p,ap as pe,a8 as ce,b as v,A as me,C as I,t as h,ar as fe,aj as ve,as as ge,s as _e,a7 as G,J as we,ag as be,aw as ye,ac as ke,F as xe,p as Ve,ae as Ue,aH as ze,at as he,aI as Ce,aJ as Re,aK as De,aL as Be}from"./index-pI8Ea0fp.js";import{g as Le}from"./role-G-r90Oi0.js";const Ie={class:"page-container"},$e={class:"pagination-container"},Se={class:"avatar-upload-container"},Me={class:"avatar-input-wrapper"},je={class:"dialog-footer"},Ee={style:{"font-weight":"500",color:"#303133"}},Ne={style:{"font-size":"12px",color:"#909399","margin-top":"4px"}},Te={__name:"UserManage",setup(Ae){const R=i(!1),$=i([]),S=i(0),_=i(1),C=i(10),k=J({username:""}),w=i(!1),c=i("create"),x=i(null),D=i(!1),s=J({id:null,username:"",password:"",nickname:"",email:"",avatar:"",status:1}),V=i(!1),M=i([]),U=i([]),B=i(null),L=i(!1),H={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:20,message:"用户名长度在 3 到 20 个字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"用户名只能包含字母、数字和下划线",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],nickname:[{max:50,message:"昵称长度不能超过 50 个字符",trigger:"blur"}],avatar:[{type:"url",message:"请输入正确的URL地址",trigger:"blur"}]},b=async()=>{R.value=!0;try{const r=await ue({page:_.value,size:C.value,username:k.username});$.value=r.list||[],S.value=r.total||0}catch(r){u.error("获取用户列表失败"),console.error(r)}finally{R.value=!1}},K=()=>{_.value=1,b()},Z=()=>{k.username="",_.value=1,b()},j=async(r,e)=>{if(c.value=r,w.value=!0,x.value&&x.value.clearValidate(),r==="edit"&&e)try{const o=await Ue({id:e.id});Object.assign(s,{id:o.id,username:o.username,nickname:o.nickname||"",email:o.email||"",avatar:o.avatar||"",status:o.status||1,password:""})}catch(o){u.error("获取用户信息失败"),console.error(o),w.value=!1}else Object.assign(s,{id:null,username:"",password:"",nickname:"",email:"",avatar:"",status:1})},Q=async()=>{var r,e;if(x.value){try{await x.value.validate()}catch{return}if(c.value==="create"&&!s.password){u.warning("请输入密码");return}if(c.value==="edit"&&s.password&&(s.password.length<6||s.password.length>20)){u.warning("密码长度在 6 到 20 个字符");return}D.value=!0;try{if(c.value==="create")await Re({username:s.username,password:s.password,nickname:s.nickname,email:s.email,avatar:s.avatar}),u.success("创建成功");else{const o={username:s.username,nickname:s.nickname,email:s.email,avatar:s.avatar,status:s.status};s.password&&(o.password=s.password),await De({id:s.id,...o}),u.success("更新成功")}w.value=!1,b()}catch(o){u.error(((e=(r=o.response)==null?void 0:r.data)==null?void 0:e.message)||"操作失败"),console.error(o)}finally{D.value=!1}}},W=r=>{he.confirm("确认删除该用户？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{try{await Ce({id:r.id}),u.success("删除成功"),b()}catch(e){u.error("删除失败"),console.error(e)}}).catch(()=>{})},X=async r=>{B.value=r.id,V.value=!0,U.value=[];try{const e=await Le({page:1,size:100});M.value=e.list||[]}catch(e){u.error("获取角色列表失败"),console.error(e);return}try{const e=await ze({id:r.id});U.value=e.roleIds||[]}catch(e){u.error("获取用户角色失败"),console.error(e)}},Y=async()=>{if(B.value){L.value=!0;try{await Be({id:B.value,roleIds:U.value}),u.success("角色分配成功"),V.value=!1}catch(r){u.error("角色分配失败"),console.error(r)}finally{L.value=!1}}};return ne([_,C],()=>{b()}),ie(()=>{b()}),(r,e)=>{const o=n("el-input"),f=n("el-form-item"),m=n("el-button"),E=n("el-form"),N=n("el-card"),g=n("el-table-column"),T=n("el-avatar"),A=n("el-tag"),ee=n("el-table"),ae=n("el-pagination"),y=n("el-icon"),le=n("el-switch"),F=n("el-dialog"),te=n("el-checkbox"),se=n("el-checkbox-group"),oe=de("loading");return z(),O("div",Ie,[a(N,{shadow:"never",class:"filter-card"},{default:l(()=>[a(E,{inline:!0,model:k,class:"filter-form"},{default:l(()=>[a(f,{label:"用户名"},{default:l(()=>[a(o,{modelValue:k.username,"onUpdate:modelValue":e[0]||(e[0]=t=>k.username=t),placeholder:"请输入用户名",clearable:"","prefix-icon":d(P),style:{width:"260px"},size:"default"},null,8,["modelValue","prefix-icon"])]),_:1}),a(f,null,{default:l(()=>[a(m,{type:"primary",icon:d(P),onClick:K,size:"default"},{default:l(()=>[...e[15]||(e[15]=[p("查询",-1)])]),_:1},8,["icon"]),a(m,{icon:d(pe),onClick:Z,size:"default"},{default:l(()=>[...e[16]||(e[16]=[p("重置",-1)])]),_:1},8,["icon"])]),_:1}),a(f,{style:{"margin-left":"auto"}},{default:l(()=>[a(m,{type:"primary",icon:d(ce),onClick:e[1]||(e[1]=t=>j("create")),size:"default"},{default:l(()=>[...e[17]||(e[17]=[v("span",{style:{"margin-left":"4px"}},"新增用户",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),a(N,{shadow:"never",class:"table-card"},{default:l(()=>[me((z(),I(ee,{data:$.value,style:{width:"100%"}},{default:l(()=>[a(g,{prop:"id",label:"ID",width:"80"}),a(g,{label:"头像",width:"80"},{default:l(t=>[a(T,{size:32,src:t.row.avatar||"https://picsum.photos/id/64/100/100"},null,8,["src"])]),_:1}),a(g,{prop:"username",label:"用户名"}),a(g,{prop:"nickname",label:"昵称"}),a(g,{prop:"email",label:"邮箱"}),a(g,{prop:"status",label:"状态",width:"100"},{default:l(t=>[a(A,{type:t.row.status===1?"success":"danger"},{default:l(()=>[p(h(t.row.status===1?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"createdAt",label:"创建时间",width:"180"}),a(g,{label:"操作",width:"280",fixed:"right"},{default:l(t=>[a(m,{link:"",type:"primary",size:"small",icon:d(fe),onClick:q=>j("edit",t.row)},{default:l(()=>[...e[18]||(e[18]=[p("编辑",-1)])]),_:1},8,["icon","onClick"]),a(m,{link:"",type:"success",size:"small",icon:d(ve),onClick:q=>X(t.row)},{default:l(()=>[...e[19]||(e[19]=[p("角色",-1)])]),_:1},8,["icon","onClick"]),a(m,{link:"",type:"danger",size:"small",icon:d(ge),onClick:q=>W(t.row)},{default:l(()=>[...e[20]||(e[20]=[p("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[oe,R.value]]),v("div",$e,[a(ae,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:S.value,"page-sizes":[10,20,30,50],"current-page":_.value,"onUpdate:currentPage":e[2]||(e[2]=t=>_.value=t),"page-size":C.value,"onUpdate:pageSize":e[3]||(e[3]=t=>C.value=t)},null,8,["total","current-page","page-size"])])]),_:1}),a(F,{modelValue:w.value,"onUpdate:modelValue":e[11]||(e[11]=t=>w.value=t),title:c.value==="create"?"新增用户":"编辑用户",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:l(()=>[v("div",je,[a(m,{onClick:e[10]||(e[10]=t=>w.value=!1),size:"large"},{default:l(()=>[...e[22]||(e[22]=[p("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:Q,size:"large",loading:D.value},{default:l(()=>[p(h(c.value==="create"?"创建":"保存"),1)]),_:1},8,["loading"])])]),default:l(()=>[a(E,{ref_key:"formRef",ref:x,model:s,rules:H,"label-width":"100px","label-position":"right"},{default:l(()=>[a(f,{label:"头像",prop:"avatar"},{default:l(()=>[v("div",Se,[a(T,{size:80,src:s.avatar||"https://picsum.photos/id/64/100/100",class:"avatar-preview"},{default:l(()=>[a(y,null,{default:l(()=>[a(d(G))]),_:1})]),_:1},8,["src"]),v("div",Me,[a(o,{modelValue:s.avatar,"onUpdate:modelValue":e[4]||(e[4]=t=>s.avatar=t),placeholder:"请输入头像URL",clearable:""},{prefix:l(()=>[a(y,null,{default:l(()=>[a(d(we))]),_:1})]),_:1},8,["modelValue"]),e[21]||(e[21]=v("div",{class:"avatar-tip"},"支持图片URL链接",-1))])])]),_:1}),a(f,{label:"用户名",prop:"username"},{default:l(()=>[a(o,{modelValue:s.username,"onUpdate:modelValue":e[5]||(e[5]=t=>s.username=t),placeholder:"请输入用户名",clearable:"",disabled:c.value==="edit"},{prefix:l(()=>[a(y,null,{default:l(()=>[a(d(G))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1}),a(f,{label:"密码",prop:c.value==="create"?"password":""},{default:l(()=>[a(o,{modelValue:s.password,"onUpdate:modelValue":e[6]||(e[6]=t=>s.password=t),type:"password",placeholder:c.value==="create"?"请输入密码":"留空则不修改密码","show-password":"",clearable:""},{prefix:l(()=>[a(y,null,{default:l(()=>[a(d(be))]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1},8,["prop"]),a(f,{label:"昵称",prop:"nickname"},{default:l(()=>[a(o,{modelValue:s.nickname,"onUpdate:modelValue":e[7]||(e[7]=t=>s.nickname=t),placeholder:"请输入昵称",clearable:""},{prefix:l(()=>[a(y,null,{default:l(()=>[a(d(ye))]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"邮箱",prop:"email"},{default:l(()=>[a(o,{modelValue:s.email,"onUpdate:modelValue":e[8]||(e[8]=t=>s.email=t),placeholder:"请输入邮箱地址",clearable:""},{prefix:l(()=>[a(y,null,{default:l(()=>[a(d(ke))]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.value==="edit"?(z(),I(f,{key:0,label:"状态",prop:"status"},{default:l(()=>[a(le,{modelValue:s.status,"onUpdate:modelValue":e[9]||(e[9]=t=>s.status=t),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用","inline-prompt":"",size:"large",class:"status-switch",style:{"--el-switch-on-color":"#67c23a"}},null,8,["modelValue"])]),_:1})):_e("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(F,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=t=>V.value=t),title:"分配角色",width:"500px","close-on-click-modal":!1},{footer:l(()=>[a(m,{onClick:e[13]||(e[13]=t=>V.value=!1)},{default:l(()=>[...e[23]||(e[23]=[p("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:Y,loading:L.value},{default:l(()=>[...e[24]||(e[24]=[p("保存",-1)])]),_:1},8,["loading"])]),default:l(()=>[a(se,{modelValue:U.value,"onUpdate:modelValue":e[12]||(e[12]=t=>U.value=t),style:{width:"100%"}},{default:l(()=>[(z(!0),O(xe,null,Ve(M.value,t=>(z(),I(te,{key:t.id,label:t.id,style:{display:"block","margin-bottom":"12px",padding:"8px","border-radius":"4px",border:"1px solid #e4e7ed"}},{default:l(()=>[v("div",null,[v("div",Ee,h(t.name),1),v("div",Ne,h(t.desc||"无描述"),1),a(A,{size:"small",style:{"margin-top":"4px"}},{default:l(()=>[p(h(t.key),1)]),_:2},1024)])]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])}}},Je=re(Te,[["__scopeId","data-v-23dd19c9"]]);export{Je as default};
