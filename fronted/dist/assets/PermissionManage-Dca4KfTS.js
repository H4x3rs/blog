import{_ as J,r as g,af as U,c as K,o as Q,a as R,d as l,g as t,h as s,E as m,B as W,l as v,u as c,a2 as B,m as p,ap as X,a8 as $,b as Y,A as Z,C as z,t as F,s as E,ar as ee,as as le,at as te}from"./index-Cyn0SW9k.js";import{g as ae,a as oe,d as ne,c as re,u as de}from"./permission-pgm8deY1.js";const se={class:"page-container"},ie={__name:"PermissionManage",setup(ue){const w=g(!1),V=g([]),i=U({name:"",type:""}),_=g(!1),h=g("create"),a=U({id:null,name:"",code:"",type:"menu",path:"",parentId:0}),k=async()=>{w.value=!0;try{const d=await ae();V.value=d.list||[]}catch(d){m.error("获取权限列表失败"),console.error(d)}finally{w.value=!1}},C=(d,e,r)=>d.filter(n=>{var y;const f=!e||((y=n.name)==null?void 0:y.toLowerCase().includes(e.toLowerCase())),I=!r||n.type===r;let u=[];return n.children&&n.children.length>0&&(u=C(n.children,e,r)),f&&I||u.length>0}).map(n=>{if(n.children&&n.children.length>0){const f=C(n.children,e,r);return{...n,children:f}}return n}),L=K(()=>!i.name&&!i.type?V.value:C(V.value,i.name,i.type)),N=()=>{},T=()=>{i.name="",i.type=""},x=async(d,e)=>{if(h.value=d,_.value=!0,d==="edit"&&e)try{const r=await oe({id:e.id});Object.assign(a,{id:r.id,name:r.name,code:r.code,type:r.type,path:r.path||"",parentId:r.parentId||0})}catch(r){m.error("获取权限信息失败"),console.error(r)}else d==="create"&&e?Object.assign(a,{id:null,name:"",code:"",type:"btn",path:"",parentId:e.id}):Object.assign(a,{id:null,name:"",code:"",type:"menu",path:"",parentId:0})},j=async()=>{if(!a.name||!a.code){m.warning("请填写完整信息");return}try{h.value==="create"?(await re({name:a.name,code:a.code,type:a.type,path:a.path,parentId:a.parentId||0}),m.success("创建成功")):(await de({id:a.id,name:a.name,code:a.code,type:a.type,path:a.path,parentId:a.parentId||0}),m.success("更新成功")),_.value=!1,k()}catch(d){m.error("操作失败"),console.error(d)}},O=d=>{te.confirm("确认删除？","提示",{type:"warning"}).then(async()=>{try{await ne({id:d.id}),m.success("删除成功"),k()}catch(e){m.error("删除失败"),console.error(e)}}).catch(()=>{})};return Q(()=>{k()}),(d,e)=>{const r=s("el-input"),n=s("el-form-item"),f=s("el-option"),I=s("el-select"),u=s("el-button"),y=s("el-form"),D=s("el-card"),b=s("el-table-column"),S=s("el-tag"),A=s("el-table"),M=s("el-radio"),q=s("el-radio-group"),G=s("el-dialog"),H=W("loading");return v(),R("div",se,[l(D,{shadow:"never",class:"filter-card"},{default:t(()=>[l(y,{inline:!0,model:i,class:"filter-form"},{default:t(()=>[l(n,{label:"权限名称"},{default:t(()=>[l(r,{modelValue:i.name,"onUpdate:modelValue":e[0]||(e[0]=o=>i.name=o),placeholder:"请输入权限名称",clearable:"","prefix-icon":c(B),style:{width:"260px"},size:"default"},null,8,["modelValue","prefix-icon"])]),_:1}),l(n,{label:"类型"},{default:t(()=>[l(I,{modelValue:i.type,"onUpdate:modelValue":e[1]||(e[1]=o=>i.type=o),placeholder:"请选择类型",clearable:"",style:{width:"140px"},size:"default"},{default:t(()=>[l(f,{label:"菜单",value:"menu"}),l(f,{label:"按钮",value:"btn"})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(u,{type:"primary",icon:c(B),onClick:N,size:"default"},{default:t(()=>[...e[9]||(e[9]=[p("查询",-1)])]),_:1},8,["icon"]),l(u,{icon:c(X),onClick:T,size:"default"},{default:t(()=>[...e[10]||(e[10]=[p("重置",-1)])]),_:1},8,["icon"])]),_:1}),l(n,{style:{"margin-left":"auto"}},{default:t(()=>[l(u,{type:"primary",icon:c($),onClick:e[2]||(e[2]=o=>x("create")),size:"default"},{default:t(()=>[...e[11]||(e[11]=[Y("span",{style:{"margin-left":"4px"}},"新增权限",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(D,{shadow:"never",class:"table-card"},{default:t(()=>[Z((v(),z(A,{data:L.value,style:{width:"100%"},"row-key":"id","default-expand-all":""},{default:t(()=>[l(b,{prop:"name",label:"权限名称","min-width":"200"}),l(b,{prop:"code",label:"权限标识","min-width":"220","show-overflow-tooltip":""}),l(b,{prop:"type",label:"类型",width:"100",align:"center"},{default:t(o=>[l(S,{size:"small",type:o.row.type==="menu"?"info":"warning"},{default:t(()=>[p(F(o.row.type==="menu"?"菜单":"按钮"),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"path",label:"路由地址","show-overflow-tooltip":""}),l(b,{label:"操作",width:"220"},{default:t(o=>[o.row.type==="menu"?(v(),z(u,{key:0,link:"",type:"primary",size:"small",icon:c($),onClick:P=>x("create",o.row)},{default:t(()=>[...e[12]||(e[12]=[p("新增",-1)])]),_:1},8,["icon","onClick"])):E("",!0),l(u,{link:"",type:"primary",size:"small",icon:c(ee),onClick:P=>x("edit",o.row)},{default:t(()=>[...e[13]||(e[13]=[p("编辑",-1)])]),_:1},8,["icon","onClick"]),l(u,{link:"",type:"danger",size:"small",icon:c(le),onClick:P=>O(o.row)},{default:t(()=>[...e[14]||(e[14]=[p("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[H,w.value]])]),_:1}),l(G,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=o=>_.value=o),title:h.value==="create"?"新增权限":"编辑权限",width:"40%"},{footer:t(()=>[l(u,{onClick:e[7]||(e[7]=o=>_.value=!1)},{default:t(()=>[...e[17]||(e[17]=[p("取消",-1)])]),_:1}),l(u,{type:"primary",onClick:j},{default:t(()=>[...e[18]||(e[18]=[p("确认",-1)])]),_:1})]),default:t(()=>[l(y,{model:a,"label-width":"80px"},{default:t(()=>[l(n,{label:"名称"},{default:t(()=>[l(r,{modelValue:a.name,"onUpdate:modelValue":e[3]||(e[3]=o=>a.name=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"标识"},{default:t(()=>[l(r,{modelValue:a.code,"onUpdate:modelValue":e[4]||(e[4]=o=>a.code=o)},null,8,["modelValue"])]),_:1}),l(n,{label:"类型"},{default:t(()=>[l(q,{modelValue:a.type,"onUpdate:modelValue":e[5]||(e[5]=o=>a.type=o)},{default:t(()=>[l(M,{label:"menu"},{default:t(()=>[...e[15]||(e[15]=[p("菜单",-1)])]),_:1}),l(M,{label:"btn"},{default:t(()=>[...e[16]||(e[16]=[p("按钮",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.type==="menu"?(v(),z(n,{key:0,label:"路径"},{default:t(()=>[l(r,{modelValue:a.path,"onUpdate:modelValue":e[6]||(e[6]=o=>a.path=o)},null,8,["modelValue"])]),_:1})):E("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ce=J(ie,[["__scopeId","data-v-b17bca1a"]]);export{ce as default};
