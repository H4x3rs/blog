import{_ as K,af as M,r as i,w as Q,o as W,a as S,d as l,g as a,h as s,E as v,B as X,l as x,u as p,a2 as Y,m as u,ap as Z,a8 as ee,A as le,s as ae,C as oe,t as z,ar as te,as as re,aw as se,J as ne,b as E,at as ie}from"./index-DuLhCfRm.js";import{g as ue,d as de,c as ce,u as me}from"./tag-qwlQzx-u.js";const pe={class:"page-container"},ge={key:0,class:"pagination-container"},fe={class:"color-picker-wrapper"},_e={class:"color-preview"},ve={class:"dialog-footer"},be={__name:"TagManage",setup(ye){const n=M({name:"",slug:""}),g=i(1),b=i(10),C=i(0),k=i(!1),h=i([]),y=i(!1),w=i("create"),F=i(null),V=i(!1),t=M({id:null,name:"",slug:"",color:"#409EFF"}),$=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#409EFF","#67C23A","#E6A23C","#F56C6C","#909399","#FF4500","#FF8C00","#FFD700","#ADFF2F","#00CED1","#1E90FF","#9370DB","#FF1493","#00FA9A","#FF69B4"],N={name:[{required:!0,message:"请输入标签名称",trigger:"blur"},{min:1,max:50,message:"标签名称长度在 1 到 50 个字符",trigger:"blur"}],slug:[{required:!0,message:"请输入别名",trigger:"blur"},{pattern:/^[a-z0-9-]+$/,message:"别名只能包含小写字母、数字和连字符",trigger:"blur"},{min:1,max:100,message:"别名长度在 1 到 100 个字符",trigger:"blur"}],color:[{required:!0,message:"请选择颜色",trigger:"change"}]},f=async()=>{k.value=!0;try{const r={page:g.value,size:b.value,name:n.name,slug:n.slug},e=await ue(r);h.value=e.list||[],C.value=e.total||0}catch(r){v.error("获取标签列表失败"),console.error(r)}finally{k.value=!1}},R=()=>{g.value=1,f()},j=()=>{n.name="",n.slug="",g.value=1,f()},D=(r,e)=>{w.value=r,y.value=!0,F.value&&F.value.clearValidate(),r==="edit"&&e?Object.assign(t,{id:e.id,name:e.name||"",slug:e.slug||"",color:e.color||"#409EFF"}):Object.assign(t,{id:null,name:"",slug:"",color:"#409EFF"})},q=async()=>{var r,e;if(F.value){try{await F.value.validate()}catch{return}V.value=!0;try{w.value==="create"?(await ce({name:t.name,slug:t.slug,color:t.color}),v.success("创建成功")):(await me({id:t.id,name:t.name,slug:t.slug,color:t.color}),v.success("更新成功")),y.value=!1,f()}catch(d){v.error(((e=(r=d.response)==null?void 0:r.data)==null?void 0:e.message)||"操作失败"),console.error(d)}finally{V.value=!1}}},L=r=>{ie.confirm("确认删除该标签？","提示",{type:"warning",confirmButtonText:"确定",cancelButtonText:"取消"}).then(async()=>{try{await de({id:r.id}),v.success("删除成功"),f()}catch(e){v.error("删除失败"),console.error(e)}}).catch(()=>{})};return Q([g,b],()=>{f()}),W(()=>{f()}),(r,e)=>{const d=s("el-input"),c=s("el-form-item"),m=s("el-button"),B=s("el-form"),T=s("el-card"),_=s("el-table-column"),A=s("el-tag"),I=s("el-table"),O=s("el-pagination"),U=s("el-icon"),P=s("el-color-picker"),J=s("el-dialog"),G=X("loading");return x(),S("div",pe,[l(T,{shadow:"never",class:"filter-card"},{default:a(()=>[l(B,{inline:!0,model:n,class:"filter-form"},{default:a(()=>[l(c,{label:"标签名称"},{default:a(()=>[l(d,{modelValue:n.name,"onUpdate:modelValue":e[0]||(e[0]=o=>n.name=o),placeholder:"请输入标签名称",clearable:"",size:"default",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(c,{label:"别名"},{default:a(()=>[l(d,{modelValue:n.slug,"onUpdate:modelValue":e[1]||(e[1]=o=>n.slug=o),placeholder:"请输入别名",clearable:"",size:"default",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(c,null,{default:a(()=>[l(m,{type:"primary",icon:p(Y),onClick:R},{default:a(()=>[...e[10]||(e[10]=[u("查询",-1)])]),_:1},8,["icon"]),l(m,{icon:p(Z),onClick:j},{default:a(()=>[...e[11]||(e[11]=[u("重置",-1)])]),_:1},8,["icon"])]),_:1}),l(c,{style:{"margin-left":"auto"}},{default:a(()=>[l(m,{type:"primary",icon:p(ee),onClick:e[2]||(e[2]=o=>D("create"))},{default:a(()=>[...e[12]||(e[12]=[u("新增标签",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(T,{shadow:"never",class:"table-card"},{default:a(()=>[le((x(),oe(I,{data:h.value,style:{width:"100%"}},{default:a(()=>[l(_,{prop:"id",label:"ID",width:"80"}),l(_,{prop:"name",label:"名称"}),l(_,{prop:"slug",label:"别名","min-width":"150","show-overflow-tooltip":""}),l(_,{prop:"color",label:"颜色"},{default:a(o=>[l(A,{color:o.row.color,effect:"dark",style:{border:"none"}},{default:a(()=>[u(z(o.row.color),1)]),_:2},1032,["color"])]),_:1}),l(_,{prop:"createdAt",label:"创建时间",width:"180"}),l(_,{label:"操作",width:"180",fixed:"right"},{default:a(o=>[l(m,{link:"",type:"primary",size:"small",icon:p(te),onClick:H=>D("edit",o.row)},{default:a(()=>[...e[13]||(e[13]=[u("编辑",-1)])]),_:1},8,["icon","onClick"]),l(m,{link:"",type:"danger",size:"small",icon:p(re),onClick:H=>L(o.row)},{default:a(()=>[...e[14]||(e[14]=[u("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[G,k.value]]),C.value>b.value?(x(),S("div",ge,[l(O,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:C.value,"page-sizes":[10,20,30,50],"current-page":g.value,"onUpdate:currentPage":e[3]||(e[3]=o=>g.value=o),"page-size":b.value,"onUpdate:pageSize":e[4]||(e[4]=o=>b.value=o)},null,8,["total","current-page","page-size"])])):ae("",!0)]),_:1}),l(J,{modelValue:y.value,"onUpdate:modelValue":e[9]||(e[9]=o=>y.value=o),title:w.value==="create"?"新增标签":"编辑标签",width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[E("div",ve,[l(m,{onClick:e[8]||(e[8]=o=>y.value=!1),size:"large"},{default:a(()=>[...e[15]||(e[15]=[u("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:q,size:"large",loading:V.value},{default:a(()=>[u(z(w.value==="create"?"创建":"保存"),1)]),_:1},8,["loading"])])]),default:a(()=>[l(B,{ref_key:"formRef",ref:F,model:t,rules:N,"label-width":"100px","label-position":"right"},{default:a(()=>[l(c,{label:"名称",prop:"name"},{default:a(()=>[l(d,{modelValue:t.name,"onUpdate:modelValue":e[5]||(e[5]=o=>t.name=o),placeholder:"请输入标签名称",clearable:"",size:"large"},{prefix:a(()=>[l(U,null,{default:a(()=>[l(p(se))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"别名",prop:"slug"},{default:a(()=>[l(d,{modelValue:t.slug,"onUpdate:modelValue":e[6]||(e[6]=o=>t.slug=o),placeholder:"请输入别名（英文，用于URL）",clearable:"",size:"large"},{prefix:a(()=>[l(U,null,{default:a(()=>[l(p(ne))]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"颜色",prop:"color"},{default:a(()=>[E("div",fe,[l(P,{modelValue:t.color,"onUpdate:modelValue":e[7]||(e[7]=o=>t.color=o),predefine:$,"show-alpha":""},null,8,["modelValue"]),E("div",_e,[l(A,{color:t.color,effect:"dark",style:{border:"none","margin-left":"12px"}},{default:a(()=>[u(z(t.color),1)]),_:1},8,["color"])])])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ce=K(be,[["__scopeId","data-v-d30282da"]]);export{Ce as default};
