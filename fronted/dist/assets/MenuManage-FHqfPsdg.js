import{_ as X,r as h,af as $,c as Y,o as F,a as ee,d as l,g as a,h as u,aN as le,E as y,B as te,l as _,u as b,a2 as T,m as p,ap as ae,a8 as j,b as oe,A as ne,C as v,t as S,s as C,Z as re,ar as se,as as de,aO as ie,at as ue,aP as pe,aQ as fe,aR as ce}from"./index-pI8Ea0fp.js";const me={class:"page-container"},ye={__name:"MenuManage",setup(_e){const M=h(!1),x=h([]),U=h([{value:0,label:"主类目"}]),i=$({title:"",type:"",status:""}),V=h(!1),I=h("create"),t=$({id:null,parentId:0,type:"C",title:"",icon:"",path:"",component:"",permission:"",order:0,status:"active"}),z=async()=>{M.value=!0;try{const d=await le();x.value=d.list||[];const e=(n,r=[])=>(n.forEach(c=>{r.push(c),c.children&&c.children.length>0&&e(c.children,r)}),r),s=e(d.list||[]);B(s)}catch(d){y.error("获取菜单列表失败"),console.error(d)}finally{M.value=!1}},B=(d,e=0,s="")=>{e===0&&(U.value=[{value:0,label:"主类目"}]),d.forEach(n=>{if(n.parentId===e){const r=s+n.title;U.value.push({value:n.id,label:r}),n.children&&n.children.length>0&&B(n.children,n.id,s+"  ")}})},D=(d,e,s,n)=>d.filter(r=>{var f;const c=!e||((f=r.title)==null?void 0:f.toLowerCase().includes(e.toLowerCase())),m=!s||r.type===s,k=!n||r.status===n;let w=[];return r.children&&r.children.length>0&&(w=D(r.children,e,s,n)),c&&m&&k||w.length>0}).map(r=>{if(r.children&&r.children.length>0){const c=D(r.children,e,s,n);return{...r,children:c}}return r}),P=Y(()=>!i.title&&!i.type&&!i.status?x.value:D(x.value,i.title,i.type,i.status)),A=()=>{},Q=()=>{i.title="",i.type="",i.status=""},E=async(d,e)=>{if(I.value=d,V.value=!0,d==="create"&&e)Object.assign(t,{id:null,parentId:e.id,type:"C",title:"",icon:"",path:"",component:"",permission:"",order:0,status:"active"});else if(d==="edit"&&e)try{const s=await ie({id:e.id});Object.assign(t,s)}catch(s){y.error("获取菜单信息失败"),console.error(s)}else Object.assign(t,{id:null,parentId:0,type:"M",title:"",icon:"",path:"",component:"",permission:"",order:0,status:"active"})},R=async()=>{if(!t.title){y.warning("请填写菜单名称");return}try{I.value==="create"?(await fe({parentId:t.parentId,type:t.type,title:t.title,icon:t.icon,path:t.path,component:t.component,permission:t.permission,order:t.order,status:t.status}),y.success("创建成功")):(await ce({id:t.id,parentId:t.parentId,type:t.type,title:t.title,icon:t.icon,path:t.path,component:t.component,permission:t.permission,order:t.order,status:t.status}),y.success("更新成功")),V.value=!1,z()}catch(d){y.error("操作失败"),console.error(d)}},Z=d=>{ue.confirm("确认删除？","提示",{type:"warning"}).then(async()=>{try{await pe({id:d.id}),y.success("删除成功"),z()}catch(e){y.error("删除失败"),console.error(e)}}).catch(()=>{})};return F(()=>{z()}),(d,e)=>{const s=u("el-input"),n=u("el-form-item"),r=u("el-option"),c=u("el-select"),m=u("el-button"),k=u("el-form"),w=u("el-card"),f=u("el-table-column"),N=u("el-tag"),q=u("el-icon"),G=u("el-table"),H=u("el-tree-select"),g=u("el-radio"),O=u("el-radio-group"),J=u("el-input-number"),K=u("el-dialog"),W=te("loading");return _(),ee("div",me,[l(w,{shadow:"never",class:"filter-card"},{default:a(()=>[l(k,{inline:!0,model:i,class:"filter-form"},{default:a(()=>[l(n,{label:"菜单名称"},{default:a(()=>[l(s,{modelValue:i.title,"onUpdate:modelValue":e[0]||(e[0]=o=>i.title=o),placeholder:"请输入菜单名称",clearable:"","prefix-icon":b(T),style:{width:"260px"},size:"default"},null,8,["modelValue","prefix-icon"])]),_:1}),l(n,{label:"类型"},{default:a(()=>[l(c,{modelValue:i.type,"onUpdate:modelValue":e[1]||(e[1]=o=>i.type=o),placeholder:"请选择类型",clearable:"",style:{width:"140px"},size:"default"},{default:a(()=>[l(r,{label:"目录",value:"M"}),l(r,{label:"菜单",value:"C"}),l(r,{label:"按钮",value:"F"})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"状态"},{default:a(()=>[l(c,{modelValue:i.status,"onUpdate:modelValue":e[2]||(e[2]=o=>i.status=o),placeholder:"请选择状态",clearable:"",style:{width:"140px"},size:"default"},{default:a(()=>[l(r,{label:"启用",value:"active"}),l(r,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(m,{type:"primary",icon:b(T),onClick:A,size:"default"},{default:a(()=>[...e[15]||(e[15]=[p("查询",-1)])]),_:1},8,["icon"]),l(m,{icon:b(ae),onClick:Q,size:"default"},{default:a(()=>[...e[16]||(e[16]=[p("重置",-1)])]),_:1},8,["icon"])]),_:1}),l(n,{style:{"margin-left":"auto"}},{default:a(()=>[l(m,{type:"primary",icon:b(j),onClick:e[3]||(e[3]=o=>E("create")),size:"default"},{default:a(()=>[...e[17]||(e[17]=[oe("span",{style:{"margin-left":"4px"}},"新增菜单",-1)])]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),l(w,{shadow:"never",class:"table-card"},{default:a(()=>[ne((_(),v(G,{data:P.value,style:{width:"100%"},"row-key":"id","default-expand-all":"","tree-props":{children:"children",hasChildren:"hasChildren"}},{default:a(()=>[l(f,{prop:"title",label:"菜单名称","min-width":"200"}),l(f,{prop:"type",label:"类型",width:"100",align:"center"},{default:a(o=>[l(N,{type:o.row.type==="M"?"info":o.row.type==="C"?"primary":"warning",size:"small"},{default:a(()=>[p(S(o.row.type==="M"?"目录":o.row.type==="C"?"菜单":"按钮"),1)]),_:2},1032,["type"])]),_:1}),l(f,{prop:"icon",label:"图标",width:"80",align:"center"},{default:a(o=>[o.row.icon?(_(),v(q,{key:0},{default:a(()=>[(_(),v(re(o.row.icon)))]),_:2},1024)):C("",!0)]),_:1}),l(f,{prop:"order",label:"排序",width:"80"}),l(f,{prop:"path",label:"路由地址","show-overflow-tooltip":""}),l(f,{prop:"component",label:"组件路径","show-overflow-tooltip":""}),l(f,{prop:"permission",label:"权限字符","show-overflow-tooltip":""}),l(f,{prop:"status",label:"状态",width:"100"},{default:a(o=>[l(N,{type:o.row.status==="active"?"success":"info"},{default:a(()=>[p(S(o.row.status==="active"?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),l(f,{label:"操作",width:"220",fixed:"right"},{default:a(o=>[l(m,{link:"",type:"primary",size:"small",icon:b(j),onClick:L=>E("create",o.row)},{default:a(()=>[...e[18]||(e[18]=[p("新增",-1)])]),_:1},8,["icon","onClick"]),l(m,{link:"",type:"primary",size:"small",icon:b(se),onClick:L=>E("edit",o.row)},{default:a(()=>[...e[19]||(e[19]=[p("编辑",-1)])]),_:1},8,["icon","onClick"]),l(m,{link:"",type:"danger",size:"small",icon:b(de),onClick:L=>Z(o.row)},{default:a(()=>[...e[20]||(e[20]=[p("删除",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])),[[W,M.value]])]),_:1}),l(K,{modelValue:V.value,"onUpdate:modelValue":e[14]||(e[14]=o=>V.value=o),title:I.value==="create"?"新增菜单":"编辑菜单",width:"40%"},{footer:a(()=>[l(m,{onClick:e[13]||(e[13]=o=>V.value=!1)},{default:a(()=>[...e[26]||(e[26]=[p("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:R},{default:a(()=>[...e[27]||(e[27]=[p("确认",-1)])]),_:1})]),default:a(()=>[l(k,{model:t,"label-width":"100px"},{default:a(()=>[l(n,{label:"上级菜单"},{default:a(()=>[l(H,{modelValue:t.parentId,"onUpdate:modelValue":e[4]||(e[4]=o=>t.parentId=o),data:U.value,"check-strictly":"","render-after-expand":!1,placeholder:"选择上级菜单",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),l(n,{label:"菜单类型"},{default:a(()=>[l(O,{modelValue:t.type,"onUpdate:modelValue":e[5]||(e[5]=o=>t.type=o)},{default:a(()=>[l(g,{label:"M"},{default:a(()=>[...e[21]||(e[21]=[p("目录",-1)])]),_:1}),l(g,{label:"C"},{default:a(()=>[...e[22]||(e[22]=[p("菜单",-1)])]),_:1}),l(g,{label:"F"},{default:a(()=>[...e[23]||(e[23]=[p("按钮",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"菜单名称"},{default:a(()=>[l(s,{modelValue:t.title,"onUpdate:modelValue":e[6]||(e[6]=o=>t.title=o)},null,8,["modelValue"])]),_:1}),t.type!=="F"?(_(),v(n,{key:0,label:"图标"},{default:a(()=>[l(s,{modelValue:t.icon,"onUpdate:modelValue":e[7]||(e[7]=o=>t.icon=o),placeholder:"Element Plus Icon Name"},null,8,["modelValue"])]),_:1})):C("",!0),t.type!=="F"?(_(),v(n,{key:1,label:"路由地址"},{default:a(()=>[l(s,{modelValue:t.path,"onUpdate:modelValue":e[8]||(e[8]=o=>t.path=o)},null,8,["modelValue"])]),_:1})):C("",!0),t.type==="C"?(_(),v(n,{key:2,label:"组件路径"},{default:a(()=>[l(s,{modelValue:t.component,"onUpdate:modelValue":e[9]||(e[9]=o=>t.component=o)},null,8,["modelValue"])]),_:1})):C("",!0),t.type!=="M"?(_(),v(n,{key:3,label:"权限字符"},{default:a(()=>[l(s,{modelValue:t.permission,"onUpdate:modelValue":e[10]||(e[10]=o=>t.permission=o)},null,8,["modelValue"])]),_:1})):C("",!0),l(n,{label:"显示排序"},{default:a(()=>[l(J,{modelValue:t.order,"onUpdate:modelValue":e[11]||(e[11]=o=>t.order=o),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"状态"},{default:a(()=>[l(O,{modelValue:t.status,"onUpdate:modelValue":e[12]||(e[12]=o=>t.status=o)},{default:a(()=>[l(g,{label:"active"},{default:a(()=>[...e[24]||(e[24]=[p("启用",-1)])]),_:1}),l(g,{label:"inactive"},{default:a(()=>[...e[25]||(e[25]=[p("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ve=X(ye,[["__scopeId","data-v-7b15ba6f"]]);export{ve as default};
