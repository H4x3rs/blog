import{_ as K,r as L,af as D,o as O,a as E,d as e,g as a,h as d,i as T,aX as j,E as c,l as C,b as o,u as g,a7 as I,aY as J,m as y,t as h,ac as W,aZ as X,F as Y,p as Z,C as $,J as H,a_ as Q,a$ as F,b0 as ee}from"./index-pI8Ea0fp.js";import{g as ae}from"./role-G-r90Oi0.js";const le={class:"page-container"},te={class:"user-profile"},oe={class:"avatar-wrapper"},se={class:"avatar-edit-overlay"},ne={class:"role-tag"},re={class:"username"},ie={class:"bio"},de={class:"user-meta"},ue={class:"meta-item"},me={class:"meta-item"},ce={class:"meta-item"},pe={class:"skills"},_e={class:"tags"},fe={class:"avatar-form-item"},ve={class:"avatar-input-group"},we={__name:"Profile",setup(ge){const x=L("info"),p=L({avatar:"",nickname:"",username:"",role:"用户",email:"",location:"Shanghai, China",bio:"",tags:["Golang","Vue 3","Kubernetes","DevOps"]}),n=D({avatar:"",nickname:"",email:"",bio:""}),i=D({old:"",new:"",confirm:""}),z=async()=>{try{const s=await T();let l="用户";try{const t=await j();if(t&&t.roleIds&&t.roleIds.length>0){const u=await ae({page:1,size:100});if(u&&u.list){const v=u.list.find(V=>V.id===t.roleIds[0]);v&&(l=v.name)}}}catch(t){console.warn("获取用户角色失败:",t)}p.value={avatar:s.avatar||"https://picsum.photos/id/64/200/200",nickname:s.nickname||s.username,username:s.username,role:l,email:s.email||"",location:"Shanghai, China",bio:"",tags:["Golang","Vue 3","Kubernetes","DevOps"]},n.avatar=s.avatar||"",n.nickname=s.nickname||s.username,n.email=s.email||"",n.bio=""}catch(s){c.error("获取用户信息失败"),console.error(s)}},M=async()=>{try{await F({nickname:n.nickname,email:n.email,avatar:n.avatar,bio:n.bio}),c.success("个人资料更新成功"),z()}catch(s){c.error("更新失败"),console.error(s)}},N=async()=>{if(!i.old||!i.new){c.warning("请填写完整信息");return}if(i.new!==i.confirm){c.error("两次输入的密码不一致");return}try{await ee({oldPassword:i.old,newPassword:i.new}),c.success("密码修改成功，下次登录生效"),i.old="",i.new="",i.confirm=""}catch(s){c.error("密码修改失败"),console.error(s)}},P=s=>{const l=s.type.startsWith("image/"),t=s.size/1024/1024<2;return l?t?!0:(c.error("图片大小不能超过 2MB!"),!1):(c.error("只能上传图片文件!"),!1)},R=async s=>{const l=s.file;try{c.info("正在处理图片...");const t=await S(l,.7,400);n.avatar=t,p.value.avatar=t;try{await F({nickname:n.nickname,email:n.email,avatar:t,bio:n.bio}),c.success("头像更新成功");const u=t.substring(0,500);localStorage.setItem("avatar",u)}catch(u){c.error("头像保存失败："+(u.message||"未知错误")),console.error(u)}}catch(t){c.error("头像上传失败"),console.error(t)}},S=(s,l=.8,t=800)=>new Promise(u=>{const v=new FileReader;v.onload=V=>{const _=new Image;_.onload=()=>{const b=document.createElement("canvas");let m=_.width,w=_.height;m>t&&(w=w*t/m,m=t),b.width=m,b.height=w,b.getContext("2d").drawImage(_,0,0,m,w);const k=b.toDataURL("image/jpeg",l);u(k)},_.src=V.target.result},v.readAsDataURL(s)});return O(()=>{z()}),(s,l)=>{const t=d("el-icon"),u=d("el-avatar"),v=d("el-upload"),V=d("el-tag"),_=d("el-card"),b=d("el-col"),m=d("el-input"),w=d("el-button"),f=d("el-form-item"),k=d("el-form"),U=d("el-tab-pane"),B=d("el-timeline-item"),A=d("el-timeline"),q=d("el-tabs"),G=d("el-row");return C(),E("div",le,[e(G,{gutter:20},{default:a(()=>[e(b,{span:8,xs:24},{default:a(()=>[e(_,{shadow:"never",class:"profile-card"},{default:a(()=>[o("div",te,[o("div",oe,[e(v,{class:"avatar-uploader","show-file-list":!1,"before-upload":P,"http-request":R,accept:"image/*"},{default:a(()=>[e(u,{size:100,src:p.value.avatar},{default:a(()=>[e(t,null,{default:a(()=>[e(g(I))]),_:1})]),_:1},8,["src"]),o("div",se,[e(t,null,{default:a(()=>[e(g(J))]),_:1}),l[8]||(l[8]=o("span",null,"更换头像",-1))])]),_:1}),o("div",ne,[e(V,{type:"success",size:"small",effect:"dark"},{default:a(()=>[y(h(p.value.role),1)]),_:1})])]),o("h3",re,h(p.value.nickname),1),o("p",ie,h(p.value.bio),1),o("div",de,[o("div",ue,[e(t,null,{default:a(()=>[e(g(I))]),_:1}),o("span",null,h(p.value.username),1)]),o("div",me,[e(t,null,{default:a(()=>[e(g(W))]),_:1}),o("span",null,h(p.value.email),1)]),o("div",ce,[e(t,null,{default:a(()=>[e(g(X))]),_:1}),o("span",null,h(p.value.location),1)])]),l[10]||(l[10]=o("div",{class:"divider"},null,-1)),o("div",pe,[l[9]||(l[9]=o("div",{class:"skills-title"},"标签",-1)),o("div",_e,[(C(!0),E(Y,null,Z(p.value.tags,r=>(C(),$(V,{key:r,class:"tag-item",size:"small"},{default:a(()=>[y(h(r),1)]),_:2},1024))),128))])])])]),_:1})]),_:1}),e(b,{span:16,xs:24},{default:a(()=>[e(_,{shadow:"never",class:"settings-card"},{default:a(()=>[e(q,{modelValue:x.value,"onUpdate:modelValue":l[7]||(l[7]=r=>x.value=r)},{default:a(()=>[e(U,{label:"基本资料",name:"info"},{default:a(()=>[e(k,{model:n,"label-width":"80px",class:"profile-form"},{default:a(()=>[e(f,{label:"头像"},{default:a(()=>[o("div",fe,[e(u,{size:80,src:n.avatar||p.value.avatar},{default:a(()=>[e(t,null,{default:a(()=>[e(g(I))]),_:1})]),_:1},8,["src"]),o("div",ve,[e(m,{modelValue:n.avatar,"onUpdate:modelValue":l[0]||(l[0]=r=>n.avatar=r),placeholder:"请输入头像URL或上传图片",clearable:"",size:"large"},{prefix:a(()=>[e(t,null,{default:a(()=>[e(g(H))]),_:1})]),_:1},8,["modelValue"]),e(v,{class:"avatar-url-uploader","show-file-list":!1,"before-upload":P,"http-request":R,accept:"image/*"},{default:a(()=>[e(w,{type:"primary",icon:g(Q),size:"large"},{default:a(()=>[...l[11]||(l[11]=[y("上传图片",-1)])]),_:1},8,["icon"])]),_:1})])])]),_:1}),e(f,{label:"昵称"},{default:a(()=>[e(m,{modelValue:n.nickname,"onUpdate:modelValue":l[1]||(l[1]=r=>n.nickname=r),size:"large"},null,8,["modelValue"])]),_:1}),e(f,{label:"邮箱"},{default:a(()=>[e(m,{modelValue:n.email,"onUpdate:modelValue":l[2]||(l[2]=r=>n.email=r),size:"large"},null,8,["modelValue"])]),_:1}),e(f,{label:"个人简介"},{default:a(()=>[e(m,{modelValue:n.bio,"onUpdate:modelValue":l[3]||(l[3]=r=>n.bio=r),type:"textarea",rows:3,size:"large"},null,8,["modelValue"])]),_:1}),e(f,null,{default:a(()=>[e(w,{type:"primary",onClick:M,size:"large"},{default:a(()=>[...l[12]||(l[12]=[y("保存修改",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(U,{label:"修改密码",name:"password"},{default:a(()=>[e(k,{model:i,"label-width":"80px",class:"profile-form"},{default:a(()=>[e(f,{label:"旧密码"},{default:a(()=>[e(m,{modelValue:i.old,"onUpdate:modelValue":l[4]||(l[4]=r=>i.old=r),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(f,{label:"新密码"},{default:a(()=>[e(m,{modelValue:i.new,"onUpdate:modelValue":l[5]||(l[5]=r=>i.new=r),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(f,{label:"确认密码"},{default:a(()=>[e(m,{modelValue:i.confirm,"onUpdate:modelValue":l[6]||(l[6]=r=>i.confirm=r),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),e(f,null,{default:a(()=>[e(w,{type:"primary",onClick:N},{default:a(()=>[...l[13]||(l[13]=[y("修改密码",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(U,{label:"登录日志",name:"log"},{default:a(()=>[e(A,null,{default:a(()=>[e(B,{timestamp:"2024-05-28 10:23:00",placement:"top"},{default:a(()=>[e(_,{shadow:"hover"},{default:a(()=>[...l[14]||(l[14]=[o("h4",null,"登录成功",-1),o("p",null,"IP: 192.168.1.1 (Chrome / Windows 10)",-1)])]),_:1})]),_:1}),e(B,{timestamp:"2024-05-27 18:45:00",placement:"top"},{default:a(()=>[e(_,{shadow:"hover"},{default:a(()=>[...l[15]||(l[15]=[o("h4",null,"登录成功",-1),o("p",null,"IP: 192.168.1.1 (Chrome / Windows 10)",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])}}},Ve=K(we,[["__scopeId","data-v-1b9ecd42"]]);export{Ve as default};
