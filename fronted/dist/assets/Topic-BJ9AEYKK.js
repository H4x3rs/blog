import{_ as W,r as D,o as K,c as C,a as c,b as t,A as P,t as r,B as U,d as l,g as u,h,E as Y,k as j,l as i,s as N,F as k,p as A,m as f,u as m,S as V,x as M,a9 as B,q as G}from"./index-pI8Ea0fp.js";import{g as H,a as J}from"./topic-DCQXbCEf.js";const O={class:"topic-page"},Q={class:"page-banner"},X={class:"banner-content"},Z={class:"page-subtitle"},tt={class:"content-container"},et={class:"filter-header"},st={key:0,class:"featured-section"},at={class:"featured-cover"},ot=["src"],nt={class:"featured-content"},rt={class:"featured-tags"},lt={class:"featured-title"},ct={class:"featured-desc"},it={class:"featured-meta"},dt={class:"meta-item"},ut={class:"meta-item"},_t={class:"meta-item"},pt={class:"topics-grid"},vt=["onClick"],ht={class:"topic-cover"},ft=["src"],mt={key:0,class:"topic-status"},gt={class:"topic-content"},wt={class:"topic-tags"},yt={class:"topic-title"},Ct={class:"topic-desc"},kt={class:"topic-footer"},At={class:"topic-meta"},Ft={class:"meta-item"},xt={class:"meta-item"},Tt={class:"meta-item"},$t={class:"topic-author"},bt={class:"sidebar"},Dt={class:"sidebar-card"},Nt={class:"popular-list"},Vt=["onClick"],Mt={class:"popular-rank"},Bt={class:"popular-info"},qt={class:"popular-name"},It={class:"popular-meta"},St={__name:"Topic",setup(zt){const q=j(),g=D("update"),v=D([]),F=D(!0),I=a=>{if(!a)return"";try{const e=new Date(a);if(isNaN(e.getTime()))return a;const _=new Date-e,n=Math.floor(_/(1e3*60*60*24));if(n===0)return"ä»Šå¤©";if(n===1)return"æ˜¨å¤©";if(n<7)return`${n}å¤©å‰`;if(n<30)return`${Math.floor(n/7)}å‘¨å‰`;if(n<365)return`${Math.floor(n/30)}ä¸ªæœˆå‰`;const p=e.getFullYear(),w=String(e.getMonth()+1).padStart(2,"0"),$=String(e.getDate()).padStart(2,"0");return`${p}-${w}-${$}`}catch{return a}},S=async()=>{F.value=!0;try{const a=await H({page:1,size:100}),e=await Promise.all((a.list||[]).map(async s=>{var _;try{const n=await J({id:s.id});return{id:s.id,name:s.name,description:s.description||"",cover:s.coverImage||"https://picsum.photos/id/"+s.id+"/600/400",tags:[],articleCount:((_=n.list)==null?void 0:_.length)||0,views:0,status:"è¿žè½½ä¸­",updateFrequency:"æ¯å‘¨æ›´æ–°",isFeatured:s.isFeatured===1,createdAt:s.createdAt,updatedAt:s.updatedAt,author:{name:"Admin",avatar:"https://i.pravatar.cc/150?img=1"}}}catch{return{id:s.id,name:s.name,description:s.description||"",cover:s.coverImage||"https://picsum.photos/id/"+s.id+"/600/400",tags:[],articleCount:0,views:0,status:"è¿žè½½ä¸­",updateFrequency:"æ¯å‘¨æ›´æ–°",isFeatured:s.isFeatured===1,createdAt:s.createdAt,updatedAt:s.updatedAt,author:{name:"Admin",avatar:"https://i.pravatar.cc/150?img=1"}}}}));v.value=e}catch(a){console.error("åŠ è½½ä¸“é¢˜å¤±è´¥:",a),Y.error("åŠ è½½ä¸“é¢˜å¤±è´¥")}finally{F.value=!1}};K(()=>{S()});const d=C(()=>{const a=v.value.filter(e=>e.isFeatured);return a.length===0?null:a.sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt))[0]}),z=C(()=>{var _;const a=(_=d.value)==null?void 0:_.id,s=[...v.value.filter(n=>n.id!==a)];return g.value==="views"?s.sort((n,p)=>p.views-n.views):g.value==="articles"&&s.sort((n,p)=>p.articleCount-n.articleCount),s}),E=C(()=>[...v.value].sort((a,e)=>e.views-a.views).slice(0,5)),L=C(()=>v.value.reduce((a,e)=>a+e.articleCount,0)),x=a=>a>=1e4?(a/1e4).toFixed(1)+"W":a>=1e3?(a/1e3).toFixed(1)+"K":a,T=a=>{q.push(`/topic/${a.id}`)};return(a,e)=>{const s=h("el-option"),_=h("el-select"),n=h("el-icon"),p=h("el-avatar"),w=h("el-col"),$=h("el-row"),R=U("loading");return i(),c("div",O,[t("div",Q,[t("div",X,[e[2]||(e[2]=t("h1",{class:"page-title"},"ç²¾é€‰ä¸“é¢˜",-1)),t("p",Z,r(v.value.length)+" ä¸ªä¸“é¢˜ Â· "+r(L.value)+" ç¯‡æ–‡ç« ",1)])]),P((i(),c("div",tt,[l($,{gutter:30},{default:u(()=>[l(w,{span:18,xs:24},{default:u(()=>[t("div",et,[e[3]||(e[3]=t("h3",{class:"filter-title"},"ðŸ“š å…¨éƒ¨ä¸“é¢˜",-1)),l(_,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),style:{width:"140px"}},{default:u(()=>[l(s,{label:"æœ€æ–°æ›´æ–°",value:"update"}),l(s,{label:"æœ€å¤šé˜…è¯»",value:"views"}),l(s,{label:"æœ€å¤šæ–‡ç« ",value:"articles"})]),_:1},8,["modelValue"])]),d.value?(i(),c("div",st,[t("div",{class:"featured-card",onClick:e[1]||(e[1]=o=>T(d.value))},[t("div",at,[t("img",{src:d.value.cover,alt:""},null,8,ot)]),t("div",nt,[t("div",rt,[(i(!0),c(k,null,A(d.value.tags,o=>(i(),c("span",{key:o,class:"featured-tag"},r(o),1))),128))]),t("h2",lt,r(d.value.name),1),t("p",ct,r(d.value.description),1),t("div",it,[t("span",dt,[l(n,null,{default:u(()=>[l(m(V))]),_:1}),f(" "+r(d.value.articleCount)+" ç¯‡æ–‡ç«  ",1)]),t("span",ut,[l(n,null,{default:u(()=>[l(m(M))]),_:1}),f(" "+r(x(d.value.views))+" é˜…è¯» ",1)]),t("span",_t,[l(n,null,{default:u(()=>[l(m(B))]),_:1}),f(" "+r(d.value.updateFrequency),1)])])])])])):N("",!0),t("div",pt,[(i(!0),c(k,null,A(z.value,(o,b)=>(i(),c("div",{key:o.id,class:"topic-card",style:G({animationDelay:`${b*.1}s`}),onClick:y=>T(o)},[t("div",ht,[t("img",{src:o.cover,alt:""},null,8,ft),o.status?(i(),c("div",mt,r(o.status),1)):N("",!0)]),t("div",gt,[t("div",wt,[(i(!0),c(k,null,A(o.tags,y=>(i(),c("span",{key:y,class:"topic-tag"},r(y),1))),128))]),t("h3",yt,r(o.name),1),t("p",Ct,r(o.description),1),t("div",kt,[t("div",At,[t("span",Ft,[l(n,null,{default:u(()=>[l(m(V))]),_:1}),f(" "+r(o.articleCount),1)]),t("span",xt,[l(n,null,{default:u(()=>[l(m(M))]),_:1}),f(" "+r(x(o.views)),1)]),t("span",Tt,[l(n,null,{default:u(()=>[l(m(B))]),_:1}),f(" "+r(I(o.updatedAt)),1)])]),t("div",$t,[l(p,{size:24,src:o.author.avatar},null,8,["src"]),t("span",null,r(o.author.name),1)])])])],12,vt))),128))])]),_:1}),l(w,{span:6,xs:24},{default:u(()=>[t("div",bt,[t("div",Dt,[e[4]||(e[4]=t("h4",{class:"card-title"},"æœ€å—æ¬¢è¿Ž",-1)),t("div",Nt,[(i(!0),c(k,null,A(E.value,(o,b)=>(i(),c("div",{key:o.id,class:"popular-item",onClick:y=>T(o)},[t("div",Mt,r(b+1),1),t("div",Bt,[t("div",qt,r(o.name),1),t("div",It,r(o.articleCount)+" ç¯‡ Â· "+r(x(o.views))+" é˜…è¯» ",1)])],8,Vt))),128))])])])]),_:1})]),_:1})])),[[R,F.value]])])}}},Rt=W(St,[["__scopeId","data-v-7f8d0a18"]]);export{Rt as default};
