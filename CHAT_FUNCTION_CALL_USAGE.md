# AI 问答 Function Call 使用指南

## 概述

AI 问答功能已集成 Function Calling（函数调用）能力，可以自动调用数据库查询函数来获取文章、用户、分类、菜单、权限、角色、专题、标签和设置等信息。

## 工作原理

1. **用户提问**：在聊天界面输入自然语言问题
2. **AI 分析**：AI 分析问题，判断是否需要查询数据库
3. **自动调用函数**：如果需要，AI 会自动调用相应的查询函数
4. **返回结果**：AI 根据查询结果生成回答

## 使用方式

直接在聊天界面输入问题即可，AI 会自动识别并调用相应的函数。**无需任何特殊命令或格式**。

## 示例问题

### 📝 文章相关查询

```
# 查询文章列表
"查询所有已发布的文章"
"显示最新的10篇文章"
"查找标题包含'Go语言'的文章"
"查询分类ID为1的所有文章"
"显示第2页的文章，每页20条"

# 查询单篇文章
"查询ID为5的文章详情"
"查看文章123的内容"
```

### 👤 用户相关查询

```
# 查询用户列表
"显示所有用户"
"查找用户名包含'admin'的用户"
"查询第1页的用户，每页10条"

# 查询单个用户
"查询ID为1的用户信息"
"显示用户ID为10的详细信息"
```

### 📂 分类相关查询

```
# 查询分类列表
"显示所有分类"
"查找名称包含'技术'的分类"
"查询slug为'tech'的分类"

# 查询单个分类
"查询ID为2的分类详情"
"显示slug为'programming'的分类信息"
```

### 🏷️ 标签相关查询

```
# 查询标签列表
"显示所有标签"
"查找名称包含'前端'的标签"
"查询第1页的标签"

# 查询单个标签
"查询ID为3的标签详情"
"显示slug为'vue'的标签信息"
```

### 📋 菜单相关查询

```
"显示所有菜单"
"查询菜单树形结构"
"获取所有菜单列表"
```

### 🔐 权限相关查询

```
"显示所有权限"
"查询父权限ID为0的权限列表"
"获取所有权限信息"
```

### 👥 角色相关查询

```
# 查询角色列表
"显示所有角色"
"查找名称包含'管理员'的角色"
"查询第1页的角色"

# 查询单个角色（需要先查询列表获取ID）
"查询ID为1的角色详情"
```

### 📚 专题相关查询

```
# 查询专题列表
"显示所有专题"
"查找名称包含'Go语言'的专题"
"查询第1页的专题"

# 查询单个专题
"查询ID为1的专题详情"
"显示专题5的详细信息"

# 查询专题下的文章
"查询专题ID为1下的所有文章"
"显示专题2的文章列表，第1页，每页10条"
```

### ⚙️ 系统设置相关查询

```
# 查询所有设置
"显示所有系统设置"
"查询所有配置项"

# 查询单个设置
"查询key为'site_name'的设置值"
"显示网站标题的设置"
```

## 复合查询示例

AI 可以理解复杂的问题，并自动调用多个函数：

```
"查询分类ID为1的所有已发布文章，并显示前5篇"
"查找用户ID为1创建的所有文章"
"查询专题'Go语言'下的所有文章，并显示文章详情"
```

## 注意事项

1. **自然语言提问**：直接使用自然语言提问，无需记住函数名或参数
2. **自动识别**：AI 会自动识别问题意图，选择合适的函数调用
3. **多轮对话**：支持多轮对话，可以基于之前的查询结果继续提问
4. **权限控制**：查询结果会根据当前登录用户的权限进行过滤
5. **流式响应**：前端使用流式响应，可以看到 AI 实时生成回答

## 技术细节

### 支持的函数列表

- `query_articles` - 查询文章列表
- `query_article` - 查询单篇文章
- `query_users` - 查询用户列表
- `query_user` - 查询单个用户
- `query_categories` - 查询分类列表
- `query_category` - 查询单个分类
- `query_tags` - 查询标签列表
- `query_tag` - 查询单个标签
- `query_menus` - 查询菜单树
- `query_permissions` - 查询权限列表
- `query_roles` - 查询角色列表
- `query_topics` - 查询专题列表
- `query_topic` - 查询单个专题
- `query_topic_articles` - 查询专题下的文章
- `query_settings` - 查询系统设置

### Function Calling 流程

1. 用户发送消息
2. AI 分析消息内容
3. 如果需要查询数据库，AI 生成 function call 请求
4. 后端执行函数，查询数据库
5. 将查询结果返回给 AI
6. AI 根据结果生成最终回答
7. 支持最多5轮 function call 循环

## 示例对话

**用户**：查询所有已发布的文章

**AI**：（自动调用 `query_articles` 函数）
```
根据查询结果，当前有 X 篇已发布的文章：

1. [文章标题1] - 分类：XXX，阅读量：XXX
2. [文章标题2] - 分类：XXX，阅读量：XXX
...
```

**用户**：显示第1篇文章的详细内容

**AI**：（自动调用 `query_article` 函数，使用之前查询结果中的ID）
```
[显示文章1的完整内容]
```

## 故障排查

如果 function call 没有正常工作：

1. **检查 API 配置**：确保 `config.yaml` 中配置了正确的通义千问 API Key
2. **查看后端日志**：检查是否有 function call 相关的日志输出
3. **检查权限**：确保当前用户有权限访问相关数据
4. **查看浏览器控制台**：检查前端是否有错误信息

## 最佳实践

1. **明确问题**：提问时尽量明确，例如"查询已发布的文章"比"查询文章"更明确
2. **使用ID**：如果知道具体的ID，可以直接使用，例如"查询文章ID为5"
3. **分页查询**：对于大量数据，可以指定页码和每页数量
4. **多轮对话**：利用多轮对话的优势，可以基于之前的查询结果继续提问


